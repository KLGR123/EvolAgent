### Development Step 22: Download University of Leicester’s “Can Hiccup Supply Enough Fish to Maintain a Dragon’s Diet?” PDF

**Description**: Conduct a web search for the University of Leicester paper titled "Can Hiccup Supply Enough Fish to Maintain a Dragon’s Diet?" and download the full PDF of that paper into workspace/dragon_diet_fish_bag.pdf.

**Use Cases**:
- Automated retrieval of competitor annual report PDFs for investment banking market analysis
- Bulk download of patent document PDFs matching key technology queries for IP research in R&D departments
- Scheduled scraping of regulatory compliance PDFs (e.g., SEC filings, GDPR guidelines) for corporate legal audit workflows
- Academic literature collection of marine biology and dragon physiology PDFs to support interdisciplinary research projects
- Continuous archiving of safety data sheet PDFs for chemical inventory management in manufacturing facilities
- Rapid collection of clinical guideline PDFs from medical association websites to update hospital treatment protocols
- Automatic scraping of environmental impact report PDFs on fishery sustainability for NGO policy advocacy

```
import os
import sys
import re
import requests

# Step 1: Ensure workspace directory exists
workspace = 'workspace'
if not os.path.isdir(workspace):
    print(f"ERROR: Workspace directory '{workspace}' does not exist.")
    sys.exit(1)
print(f"[INFO] Using workspace: {workspace}\n")

# Step 2: Perform a live Bing search for any PDF of the paper (no domain filter)
search_url = 'https://www.bing.com/search'
# Use straight ASCII apostrophe in the query
query = "\"Can Hiccup Supply Enough Fish to Maintain a Dragon's Diet?\" filetype:pdf"
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) '
                  'AppleWebKit/537.36 (KHTML, like Gecko) '
                  'Chrome/91.0.4472.124 Safari/537.36',
    'Accept-Language': 'en-US,en;q=0.9',
    'Accept': 'text/html'
}
print(f"[SEARCH] Querying Bing for PDF: {query}")
try:
    resp = requests.get(search_url, params={'q': query}, headers=headers, timeout=30)
    resp.raise_for_status()
    html = resp.text
    print(f"[SEARCH] Retrieved {len(html)} characters of HTML from Bing.")
except Exception as e:
    print(f"ERROR: Failed to fetch Bing search results: {e}")
    sys.exit(1)

# Step 3: Extract all PDF URLs (with optional query strings)
pattern = r"https?://[^\s\"'<>]+\.pdf(?:\?[^\s\"'<>]*)?"
all_pdfs = re.findall(pattern, html, flags=re.IGNORECASE)
print(f"[PARSE] Extracted {len(all_pdfs)} total PDF URLs from Bing HTML.")
if all_pdfs:
    for i, url in enumerate(all_pdfs[:20], 1):
        print(f"  {i}. {url}")
else:
    print("[PARSE] No PDF URLs found in Bing results.")

# Step 4: Choose the best candidate
# Prefer URLs that contain keywords from the title
candidates = [u for u in all_pdfs if any(k in u.lower() for k in ['hiccup', 'dragon', 'fish'])]
if candidates:
    print(f"[FILTER] {len(candidates)} candidate(s) matched title keywords.")
    pdf_url = candidates[0]
else:
    if all_pdfs:
        print("[FILTER] No keyword match; defaulting to first PDF URL found.")
        pdf_url = all_pdfs[0]
    else:
        print("ERROR: No PDF URLs available to download.")
        sys.exit(1)

print(f"[SELECT] PDF URL chosen: {pdf_url}\n")

# Step 5: Download the chosen PDF into workspace/dragon_diet_fish_bag.pdf
pdf_path = os.path.join(workspace, 'dragon_diet_fish_bag.pdf')
print(f"[DOWNLOAD] Downloading PDF to: {pdf_path}")
try:
    r = requests.get(pdf_url, headers=headers, stream=True, timeout=60)
    r.raise_for_status()
    with open(pdf_path, 'wb') as f:
        for chunk in r.iter_content(chunk_size=8192):
            if chunk:
                f.write(chunk)
    size = os.path.getsize(pdf_path)
    print(f"[SUCCESS] Saved PDF ({size} bytes, {size/1024:.2f} KB)")
    if size < 10 * 1024:
        print("WARNING: File smaller than 10 KB. It may not be the correct PDF.")
        sys.exit(1)
    print("[COMPLETE] PDF download successful and exceeds size threshold.")
except Exception as e:
    print(f"ERROR: Failed to download PDF: {e}")
    if os.path.exists(pdf_path):
        os.remove(pdf_path)
    sys.exit(1)
```