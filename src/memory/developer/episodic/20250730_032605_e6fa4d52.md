### Development Step 2: Extract locomotive details and calculate steam vs non-steam odds for Sunset Picnic Trip

**Description**: Parse and analyze the attached Excel file data/gaia/2023/validation/4d0aa727-86b1-406b-9b33-f870dd14a4a5.xlsx to extract locomotive data including identifying numbers, operating status, and assigned daily excursions. Specifically identify all locomotives assigned to the 'Sunset Picnic Trip' and determine how many are steam locomotives versus other types to calculate the probability odds.

**Use Cases**:
- Heritage railway event planning: automatically identify which steam locomotives are assigned to the upcoming “Sunset Picnic Trip” and calculate the odds of running a steam engine versus diesel to optimize marketing materials.
- Tourist excursion operations: integrate daily assignment data to determine locomotive type distribution on scenic trips and adjust staffing levels for boiler tenders versus diesel mechanics.
- Maintenance scheduling automation: parse weekly Excel rosters to flag steam engines on high-profile excursions, calculate their usage probability, and prioritize preventive maintenance windows.
- Safety compliance reporting: filter out locomotives operating on specific passenger routes, classify them by steam or diesel, and generate probability-based risk summaries for regulatory submissions.
- Historical performance research: extract assignment patterns for nostalgic steam excursions from archival spreadsheets, quantify steam-versus-diesel frequency, and support academic studies on heritage railway trends.
- Asset allocation optimization: analyze Excel-based locomotive rosters to compute odds of steam deployment on themed trips, informing fuel stock purchasing decisions and crew training allocations.
- Real-time excursion monitoring: automate ingestion of daily assignment sheets to classify locomotives by type, calculate steam-to-diesel ratios on special trips, and feed live dashboards for operations control.
- Financial forecasting for excursion tours: use historical locomotive assignment and type-probability data to predict operating costs on future “Sunset Picnic Trip” runs, factoring in steam fuel and maintenance overhead.

```
import os
import pandas as pd
import json

print("=== LOCOMOTIVE SUNSET PICNIC TRIP PROBABILITY ANALYSIS ===")
print("Extracting locomotive data and calculating steam vs other types probability")

# Load the Excel file based on the previous analysis
xlsx_path = "data/gaia/2023/validation/4d0aa727-86b1-406b-9b33-f870dd14a4a5.xlsx"

print(f"\nLoading Excel file: {xlsx_path}")

# Read the Excel file with pandas
df = pd.read_excel(xlsx_path)

print(f"DataFrame shape: {df.shape}")
print(f"Column names: {list(df.columns)}")

print("\n=== COMPLETE LOCOMOTIVE DATABASE ===") 
print(df.to_string())

# Clean the data by removing rows that are category headers (Steam, Diesel) or empty
print("\n=== CLEANING DATA ===")
print("Removing category header rows and empty rows...")

# Remove rows where Number column contains 'Steam' or 'Diesel' (these are category headers)
clean_df = df[~df['Number'].isin(['Steam', 'Diesel'])].copy()

# Remove rows with missing locomotive numbers or types
clean_df = clean_df.dropna(subset=['Number', 'Type/Wheel Configuration'])

print(f"\nCleaned DataFrame shape: {clean_df.shape}")
print("\nCleaned locomotive data:")
print(clean_df.to_string())

# Filter locomotives assigned to 'Sunset Picnic Trip'
print("\n=== FILTERING SUNSET PICNIC TRIP LOCOMOTIVES ===")
sunset_picnic_locomotives = clean_df[clean_df['Excursion/Location'] == 'Sunset Picnic Trip'].copy()

print(f"\nLocomotives assigned to Sunset Picnic Trip: {len(sunset_picnic_locomotives)}")
print("\nSunset Picnic Trip locomotive details:")
print(sunset_picnic_locomotives.to_string())

# Determine locomotive types (steam vs other)
print("\n=== CLASSIFYING LOCOMOTIVE TYPES ===")

# Based on the data structure observed, locomotives are grouped by sections
# Steam locomotives have wheel configurations like 0-4-0, 4-4-0, 2-6-0, 2-8-0, etc.
# Diesel locomotives have model designations like NW2, F3, PA, GP15, GP30, etc.

def classify_locomotive_type(row_index, locomotive_number, type_config):
    """Classify locomotive as steam or diesel based on position in original data and type configuration"""
    
    # Steam locomotive type configurations (wheel arrangements)
    steam_patterns = ['0-4-0', '4-4-0', '2-6-0', '2-8-0', '2-6-4', '2-8-4', '4-6-2', '4-8-4']
    
    # Diesel locomotive model designations
    diesel_patterns = ['NW2', 'F3', 'PA', 'GP15', 'GP30', 'SW1', 'RS3', 'F7']
    
    # Check if type configuration matches steam patterns
    if any(pattern in str(type_config) for pattern in steam_patterns):
        return 'Steam'
    
    # Check if type configuration matches diesel patterns  
    elif any(pattern in str(type_config) for pattern in diesel_patterns):
        return 'Diesel'
    
    # Fallback: determine by position in original data
    # From the analysis, locomotives before row with 'Diesel' are steam
    # This is row 8 in the cleaned data (index 8)
    elif row_index < 8:
        return 'Steam'
    else:
        return 'Diesel'

# Apply classification to Sunset Picnic Trip locomotives
sunset_picnic_locomotives['Locomotive_Type'] = [
    classify_locomotive_type(idx, row['Number'], row['Type/Wheel Configuration']) 
    for idx, row in sunset_picnic_locomotives.iterrows()
]

print("\nClassified Sunset Picnic Trip locomotives:")
for idx, row in sunset_picnic_locomotives.iterrows():
    print(f"Locomotive #{row['Number']} ({row['Type/Wheel Configuration']}) - Type: {row['Locomotive_Type']}")

# Count steam vs other locomotives
steam_count = len(sunset_picnic_locomotives[sunset_picnic_locomotives['Locomotive_Type'] == 'Steam'])
diesel_count = len(sunset_picnic_locomotives[sunset_picnic_locomotives['Locomotive_Type'] == 'Diesel'])
total_count = len(sunset_picnic_locomotives)

print("\n=== LOCOMOTIVE TYPE BREAKDOWN ===")
print(f"Steam locomotives on Sunset Picnic Trip: {steam_count}")
print(f"Diesel locomotives on Sunset Picnic Trip: {diesel_count}")
print(f"Total locomotives on Sunset Picnic Trip: {total_count}")

# Calculate probability and odds
print("\n=== PROBABILITY CALCULATIONS ===")

if total_count > 0:
    steam_probability = steam_count / total_count
    diesel_probability = diesel_count / total_count
    
    print(f"Probability of steam locomotive: {steam_probability:.4f} ({steam_probability*100:.1f}%)")
    print(f"Probability of diesel locomotive: {diesel_probability:.4f} ({diesel_probability*100:.1f}%)")
    
    # Calculate odds ratios
    if diesel_count > 0:
        steam_to_diesel_odds = steam_count / diesel_count
        diesel_to_steam_odds = diesel_count / steam_count
        
        print(f"\n=== ODDS RATIOS ===")
        print(f"Steam to Diesel odds: {steam_to_diesel_odds:.4f} (or {steam_count}:{diesel_count})")
        print(f"Diesel to Steam odds: {diesel_to_steam_odds:.4f} (or {diesel_count}:{steam_count})")
        
        # Express as simplified ratios
        from math import gcd
        ratio_gcd = gcd(steam_count, diesel_count)
        simplified_steam = steam_count // ratio_gcd
        simplified_diesel = diesel_count // ratio_gcd
        
        print(f"\nSimplified odds ratio: {simplified_steam}:{simplified_diesel} (steam:diesel)")
    else:
        print("All locomotives are steam - no diesel locomotives for odds calculation")
else:
    print("No locomotives found assigned to Sunset Picnic Trip")

# Save detailed results
results = {
    'analysis_summary': {
        'total_locomotives_in_database': len(clean_df),
        'sunset_picnic_trip_locomotives': total_count,
        'steam_locomotives_on_trip': steam_count,
        'diesel_locomotives_on_trip': diesel_count
    },
    'locomotive_details': [],
    'probability_analysis': {
        'steam_probability': steam_probability if total_count > 0 else 0,
        'diesel_probability': diesel_probability if total_count > 0 else 0,
        'steam_to_diesel_odds': steam_to_diesel_odds if total_count > 0 and diesel_count > 0 else None,
        'odds_ratio_simplified': f"{simplified_steam}:{simplified_diesel}" if total_count > 0 and diesel_count > 0 else None
    }
}

# Add locomotive details to results
for idx, row in sunset_picnic_locomotives.iterrows():
    locomotive_data = {
        'number': row['Number'],
        'type_configuration': row['Type/Wheel Configuration'],
        'operating_status': row['Operating Status'],
        'excursion': row['Excursion/Location'],
        'classified_type': row['Locomotive_Type']
    }
    results['locomotive_details'].append(locomotive_data)

# Save results to JSON
with open('workspace/sunset_picnic_locomotive_analysis.json', 'w') as f:
    json.dump(results, f, indent=2)

print(f"\n=== FINAL ANSWER ===")
print(f"Locomotives assigned to Sunset Picnic Trip:")
for locomotive in results['locomotive_details']:
    print(f"  - #{locomotive['number']} ({locomotive['type_configuration']}) - {locomotive['classified_type']}")

print(f"\nProbability Analysis:")
print(f"  - Steam locomotives: {steam_count} out of {total_count} ({steam_probability*100:.1f}%)")
print(f"  - Diesel locomotives: {diesel_count} out of {total_count} ({diesel_probability*100:.1f}%)")
if diesel_count > 0:
    print(f"  - Odds ratio (steam:diesel): {simplified_steam}:{simplified_diesel}")

print(f"\nDetailed analysis saved to: workspace/sunset_picnic_locomotive_analysis.json")
```