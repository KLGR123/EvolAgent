### Development Step 5: Search 2011 Bulgarian NSI Census Tertiary Education Completion Data by Gender

**Description**: Search for the 2011 Bulgarian census data on tertiary education completion by gender. Look for official census results from Bulgaria's National Statistical Institute or other authoritative sources that provide the specific breakdown of men and women who completed tertiary education in 2011.

**Use Cases**:
- Government education department automated extraction of 2011 Bulgarian tertiary completion rates by gender to inform policy adjustments and monitor progress toward gender parity
- University research team large-scale archival mining of Bulgarian census HTML files for a longitudinal study on higher education attainment trends among men and women
- NGO gender-equality advocacy group building interactive dashboards that highlight regional disparities in tertiary degree completion for targeted outreach programs
- EdTech company market-intelligence pipeline that scrapes national census education statistics to identify growth opportunities for specialized training programs, segmented by gender
- Investigative data journalism project producing web-based visual stories on the evolution of male and female university graduation rates in Bulgaria since 2011
- Data-science consultancy automating the parsing and analysis of public-domain census HTML to generate client-ready reports on higher education demographics for corporate CSR initiatives
- National statistical office integrating the HTML scraping and regex-based analysis into its regular workflow to update open-data portals with the latest tertiary education indicators by gender

```
import os
import json
from bs4 import BeautifulSoup
import re
import time

# First, let's inspect what files are actually in the workspace
print("=== INSPECTING WORKSPACE FOR BULGARIAN CENSUS DATA ===\n")

if os.path.exists('workspace'):
    files = os.listdir('workspace')
    print(f"Files found in workspace: {len(files)}")
    
    for file in files:
        filepath = f'workspace/{file}'
        if os.path.isfile(filepath):
            size = os.path.getsize(filepath)
            print(f"  {file} - {size} bytes")
else:
    print("No workspace directory found")
    exit()

# Look for HTML files that were saved from the data sources
html_files = [f for f in files if f.endswith('.html')]
print(f"\nHTML source files found: {len(html_files)}")

for html_file in html_files:
    print(f"  {html_file}")

# Now let's analyze the saved HTML files for Bulgarian census education data
print("\n=== ANALYZING SAVED HTML FILES FOR EDUCATION DATA ===\n")

analysis_results = []

for i, html_file in enumerate(html_files, 1):
    print(f"Analyzing file {i}/{len(html_files)}: {html_file}")
    
    filepath = f'workspace/{html_file}'
    
    try:
        with open(filepath, 'r', encoding='utf-8') as f:
            html_content = f.read()
        
        soup = BeautifulSoup(html_content, 'html.parser')
        
        # Get page title
        title_element = soup.find('title')
        page_title = title_element.get_text().strip() if title_element else 'No title found'
        
        # Get all text content
        text_content = soup.get_text()
        text_lower = text_content.lower()  # Fixed variable name
        
        print(f"  Title: {page_title}")
        print(f"  Content length: {len(text_content)} characters")
        
        # Check relevance for Bulgarian census and education
        has_bulgaria = 'bulgaria' in text_lower
        has_2011 = '2011' in text_lower
        has_census = 'census' in text_lower
        has_tertiary = any(term in text_lower for term in ['tertiary', 'higher education', 'university degree'])
        has_gender = any(term in text_lower for term in ['men', 'women', 'male', 'female', 'gender'])
        
        relevance_score = sum([has_bulgaria, has_2011, has_census, has_tertiary, has_gender])
        
        print(f"  Bulgaria: {has_bulgaria}, 2011: {has_2011}, Census: {has_census}")
        print(f"  Tertiary education: {has_tertiary}, Gender: {has_gender}")
        print(f"  Relevance score: {relevance_score}/5")
        
        if relevance_score >= 2:  # Analyze promising sources
            print(f"  *** HIGH RELEVANCE - DEEP ANALYSIS ***")
            
            # Search for specific education statistics
            education_sentences = []
            sentences = text_content.split('.')
            
            for sentence in sentences:
                sentence_clean = sentence.strip()
                sentence_lower = sentence_clean.lower()
                
                if len(sentence_clean) > 50:  # Skip very short sentences
                    # Look for sentences with Bulgaria + education + numbers/percentages
                    has_bulgaria_ref = 'bulgaria' in sentence_lower
                    has_education_ref = any(term in sentence_lower for term in 
                                          ['tertiary', 'education', 'university', 'higher', 'degree', 'graduate'])
                    has_numbers = bool(re.search(r'\d+[.,]?\d*\s*%?', sentence_lower))
                    has_year_ref = any(year in sentence_lower for year in ['2011', '2010', '2012'])
                    
                    if has_bulgaria_ref and has_education_ref and (has_numbers or has_year_ref):
                        education_sentences.append(sentence_clean)
            
            print(f"  Education-related sentences: {len(education_sentences)}")
            
            # Look for tables with statistical data
            tables = soup.find_all('table')
            relevant_tables = []
            
            for table_idx, table in enumerate(tables):
                table_text = table.get_text().lower()
                
                if any(term in table_text for term in ['education', 'tertiary', 'university', 'degree', 'census']):
                    # Extract table headers
                    headers = [th.get_text().strip() for th in table.find_all('th')]
                    
                    # Get first few rows of data
                    rows = table.find_all('tr')
                    sample_rows = []
                    
                    for row in rows[1:4]:  # Skip header, get first 3 data rows
                        cells = [td.get_text().strip() for td in row.find_all(['td', 'th'])]
                        if cells:
                            sample_rows.append(cells)
                    
                    relevant_tables.append({
                        'index': table_idx,
                        'headers': headers,
                        'sample_rows': sample_rows,
                        'total_rows': len(rows)
                    })
            
            print(f"  Relevant tables: {len(relevant_tables)}")
            
            # Search for specific numerical patterns related to tertiary education
            education_stats = []
            
            # Patterns to look for
            stat_patterns = [
                r'tertiary education.*?(\d+[.,]?\d*\s*%)',
                r'university.*?(\d+[.,]?\d*\s*%)',
                r'higher education.*?(\d+[.,]?\d*\s*%)',
                r'(\d+[.,]?\d*\s*%).*?tertiary',
                r'(\d+[.,]?\d*\s*%).*?university',
                r'men.*?(\d+[.,]?\d*\s*%).*?education',
                r'women.*?(\d+[.,]?\d*\s*%).*?education',
                r'education.*?men.*?(\d+[.,]?\d*\s*%)',
                r'education.*?women.*?(\d+[.,]?\d*\s*%)'
            ]
            
            for pattern in stat_patterns:
                matches = re.finditer(pattern, text_content, re.IGNORECASE | re.DOTALL)
                for match in matches:
                    # Get context around the match
                    start = max(0, match.start() - 200)
                    end = min(len(text_content), match.end() + 200)
                    context = text_content[start:end].strip()
                    
                    # Check if context mentions Bulgaria
                    if 'bulgaria' in context.lower():
                        education_stats.append({
                            'pattern': pattern,
                            'match': match.group(),
                            'context': context
                        })
            
            print(f"  Education statistics found: {len(education_stats)}")
            
            # Show key findings
            if education_sentences:
                print(f"  Sample sentence: {education_sentences[0][:200]}...")
            
            if education_stats:
                print(f"  Sample statistic: {education_stats[0]['match']}")
                print(f"  Context: {education_stats[0]['context'][:150]}...")
            
            if relevant_tables:
                print(f"  Sample table headers: {relevant_tables[0]['headers'][:5]}")
            
            # Store analysis results
            analysis_results.append({
                'filename': html_file,
                'title': page_title,
                'relevance_score': relevance_score,
                'education_sentences': education_sentences[:10],  # Top 10
                'education_statistics': education_stats[:5],      # Top 5
                'relevant_tables': relevant_tables[:3],           # Top 3
                'content_length': len(text_content)
            })
        
        print()
        
    except Exception as e:
        print(f"  âœ— Error analyzing {html_file}: {str(e)}")
        print()

# Save comprehensive analysis results
print("=== SAVING ANALYSIS RESULTS ===\n")

final_results = {
    'analysis_objective': 'Bulgarian 2011 census tertiary education by gender',
    'analysis_timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
    'files_analyzed': len(html_files),
    'relevant_sources': len(analysis_results),
    'detailed_analysis': analysis_results
}

with open('workspace/bulgarian_education_analysis_results.json', 'w', encoding='utf-8') as f:
    json.dump(final_results, f, indent=2, ensure_ascii=False)

print(f"Analysis results saved to: workspace/bulgarian_education_analysis_results.json")
print(f"Files analyzed: {len(html_files)}")
print(f"Relevant sources found: {len(analysis_results)}")

# Display summary of key findings
if analysis_results:
    print("\n=== KEY FINDINGS SUMMARY ===\n")
    
    for i, result in enumerate(analysis_results, 1):
        print(f"{i}. {result['title']} (Score: {result['relevance_score']}/5)")
        print(f"   File: {result['filename']}")
        
        if result['education_sentences']:
            print(f"   Key finding: {result['education_sentences'][0][:150]}...")
        
        if result['education_statistics']:
            print(f"   Statistic: {result['education_statistics'][0]['match']}")
        
        print()

print("=== ANALYSIS COMPLETE ===\n")
print("Ready to extract specific tertiary education completion data by gender for Bulgaria 2011")
```