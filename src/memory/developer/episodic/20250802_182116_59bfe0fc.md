### Development Step 5: Exact-Phrase ClinicalTrials.gov Search for H. pylori & Acne Vulgaris Trials (Jan‚ÄìMay 2018)

**Description**: Conduct a more targeted search specifically for clinical trials with exact phrase matching for 'H. pylori' AND 'acne vulgaris' on ClinicalTrials.gov, then expand the search timeframe to include trials that may have been registered or updated during Jan-May 2018 but had different start/end dates. Also search for variations like 'Helicobacter pylori' and 'acne' to ensure comprehensive coverage of potential trial listings that match the TASK criteria.

**Use Cases**:
- Pharma competitive intelligence tracking of H. pylori‚Äìrelated acne treatment trials to guide R&D pipeline prioritization
- Academic systematic‚Äêreview automation retrieving exact‚Äêmatch clinical studies on Helicobacter pylori and acne vulgaris registered between January and May 2018
- Regulatory affairs monitoring for new ClinicalTrials.gov registrations of randomized controlled trials targeting H. pylori eradication in dermatology
- Healthcare journalism fact‚Äêchecking workflow aggregating official trial registry details and publication snippets on acne vulgaris studies involving H. pylori
- Biotech investment due diligence tool scanning clinical trial databases for acne vulgaris interventions using novel H. pylori inhibitors to assess startup portfolios
- Clinical operations oversight sending automated alerts when trial statuses update or recruitment milestones hit in acne treatment studies with H. pylori arms
- Medical device partnership research identifying dermatology device trials that include H. pylori‚Äìfocused acne management protocols
- Marketing strategy support compiling competitor trial insights and intervention timelines for H. pylori‚Äìtargeted acne therapies to refine product positioning

```
import os
import requests
import json
from datetime import datetime
import time

# Get SerpAPI key from environment variables
api_key = os.getenv("SERPAPI_API_KEY")

if api_key is None:
    print("Error: Missing API key. Make sure you have SERPAPI_API_KEY in your environment variables.")
else:
    print("API key found, proceeding with targeted clinical trials search...")
    print("=" * 80)
    print("TARGETED SEARCH: H. PYLORI AND ACNE VULGARIS CLINICAL TRIALS")
    print("=" * 80)
    
    # Define highly specific search queries for clinical trials
    clinical_trial_queries = [
        'site:clinicaltrials.gov "H. pylori" "acne vulgaris" clinical trial',
        'site:clinicaltrials.gov "Helicobacter pylori" "acne vulgaris" study',
        'site:clinicaltrials.gov "H. pylori" acne treatment trial',
        'site:clinicaltrials.gov "Helicobacter pylori" acne clinical study',
        '"H. pylori" "acne vulgaris" clinical trial 2018 site:clinicaltrials.gov',
        '"Helicobacter pylori" acne trial registered 2018',
        'clinicaltrials.gov "H. pylori" acne study January 2018',
        'clinicaltrials.gov "H. pylori" acne study February 2018',
        'clinicaltrials.gov "H. pylori" acne study March 2018',
        'clinicaltrials.gov "H. pylori" acne study April 2018',
        'clinicaltrials.gov "H. pylori" acne study May 2018',
        '"H. pylori" acne vulgaris randomized controlled trial',
        '"Helicobacter pylori" acne treatment clinical study',
        'site:clinicaltrials.gov "H. pylori" dermatology acne trial',
        '"H. pylori eradication" "acne vulgaris" clinical trial'
    ]
    
    print(f"Executing {len(clinical_trial_queries)} targeted clinical trial searches...\n")
    
    # Store all search results
    all_search_results = []
    
    for i, query in enumerate(clinical_trial_queries, 1):
        print(f"Clinical Trial Search {i}/{len(clinical_trial_queries)}: {query}")
        print("-" * 70)
        
        # Prepare API request parameters
        params = {
            "q": query,
            "api_key": api_key,
            "engine": "google",
            "google_domain": "google.com",
            "safe": "off",
            "num": 20,  # Increased for comprehensive coverage
            "type": "search"
        }
        
        try:
            # Make API request to SerpAPI
            response = requests.get("https://serpapi.com/search.json", params=params, timeout=30)
            
            if response.status_code == 200:
                results = response.json()
                
                if results.get("organic_results"):
                    print(f"Found {len(results['organic_results'])} results")
                    
                    # Store results with query context
                    query_results = {
                        'query': query,
                        'results': results['organic_results'],
                        'search_number': i,
                        'timestamp': datetime.now().isoformat()
                    }
                    all_search_results.append(query_results)
                    
                    # Analyze and display results for clinical trial identification
                    clinical_trials_found = False
                    for j, result in enumerate(results['organic_results'][:10], 1):
                        title = result.get('title', 'No title')
                        link = result.get('link', 'No URL')
                        snippet = result.get('snippet', 'No snippet')
                        
                        # Check for clinical trial indicators
                        title_lower = title.lower()
                        snippet_lower = snippet.lower()
                        combined_text = f"{title_lower} {snippet_lower}"
                        
                        # Key indicators for clinical trials
                        h_pylori_indicators = ['h. pylori', 'helicobacter pylori', 'h pylori']
                        acne_indicators = ['acne vulgaris', 'acne', 'dermatology']
                        trial_indicators = ['clinical trial', 'study', 'randomized', 'controlled', 'intervention']
                        date_indicators = ['2018', 'january', 'february', 'march', 'april', 'may']
                        
                        h_pylori_matches = [ind for ind in h_pylori_indicators if ind in combined_text]
                        acne_matches = [ind for ind in acne_indicators if ind in combined_text]
                        trial_matches = [ind for ind in trial_indicators if ind in combined_text]
                        date_matches = [ind for ind in date_indicators if ind in combined_text]
                        
                        print(f"\n  Result {j}:")
                        print(f"    Title: {title}")
                        print(f"    URL: {link}")
                        print(f"    Snippet: {snippet[:300]}{'...' if len(snippet) > 300 else ''}")
                        
                        # Highlight critical findings
                        if h_pylori_matches and acne_matches and trial_matches:
                            print(f"    üéØ POTENTIAL CLINICAL TRIAL MATCH!")
                            print(f"    H. pylori: {', '.join(h_pylori_matches)}")
                            print(f"    Acne: {', '.join(acne_matches)}")
                            print(f"    Trial: {', '.join(trial_matches)}")
                            if date_matches:
                                print(f"    2018 dates: {', '.join(date_matches)}")
                            clinical_trials_found = True
                            
                            # Special attention to ClinicalTrials.gov results
                            if 'clinicaltrials.gov' in link.lower():
                                print(f"    üîó CLINICALTRIALS.GOV: Official clinical trial registry")
                        elif h_pylori_matches and acne_matches:
                            print(f"    ‚≠ê RELEVANT: H. pylori + Acne mentioned")
                            print(f"    H. pylori: {', '.join(h_pylori_matches)}")
                            print(f"    Acne: {', '.join(acne_matches)}")
                        elif 'clinicaltrials.gov' in link.lower() and (h_pylori_matches or acne_matches):
                            print(f"    üìã CLINICALTRIALS.GOV: Partial match")
                            if h_pylori_matches:
                                print(f"    H. pylori: {', '.join(h_pylori_matches)}")
                            if acne_matches:
                                print(f"    Acne: {', '.join(acne_matches)}")
                    
                    if not clinical_trials_found:
                        print("    No direct clinical trial matches found for this query")
                        
                else:
                    print("No organic results found for this query")
                    all_search_results.append({
                        'query': query,
                        'results': [],
                        'search_number': i,
                        'timestamp': datetime.now().isoformat()
                    })
            else:
                print(f"Error: API request failed with status {response.status_code}: {response.text}")
                
        except Exception as e:
            print(f"Error during clinical trial search {i}: {str(e)}")
            continue
        
        # Add small delay between requests to be respectful
        time.sleep(1)
        print("\n")
    
    print("\n" + "=" * 80)
    print("CLINICAL TRIAL SEARCH ANALYSIS")
    print("=" * 80)
    
    # Save all search results to workspace
    timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
    results_file = f"workspace/h_pylori_acne_clinical_trials_search_{timestamp}.json"
    
    with open(results_file, 'w', encoding='utf-8') as f:
        json.dump({
            'search_focus': 'H. pylori and acne vulgaris clinical trials',
            'target_timeframe': 'January-May 2018 (expanded search)',
            'primary_database': 'ClinicalTrials.gov',
            'search_timestamp': timestamp,
            'total_queries': len(clinical_trial_queries),
            'queries_executed': clinical_trial_queries,
            'search_results': all_search_results
        }, f, indent=2, ensure_ascii=False)
    
    print(f"Clinical trial search results saved to: {results_file}")
    
    # Analyze findings for clinical trials
    total_results = sum(len(query_result['results']) for query_result in all_search_results)
    print(f"Total search results collected: {total_results}")
    
    # Look for specific clinical trial matches
    definitive_trials = []
    potential_trials = []
    clinicaltrials_gov_results = []
    date_specific_results = []
    
    for query_result in all_search_results:
        for result in query_result['results']:
            title = result.get('title', '').lower()
            snippet = result.get('snippet', '').lower()
            link = result.get('link', '').lower()
            combined = f"{title} {snippet}"
            
            # Check for definitive clinical trial matches
            has_h_pylori = any(term in combined for term in ['h. pylori', 'helicobacter pylori', 'h pylori'])
            has_acne = any(term in combined for term in ['acne vulgaris', 'acne'])
            has_trial = any(term in combined for term in ['clinical trial', 'study', 'randomized', 'controlled'])
            has_2018 = '2018' in combined
            is_clinicaltrials = 'clinicaltrials.gov' in link
            
            # Categorize results
            if has_h_pylori and has_acne and has_trial:
                definitive_trials.append({
                    'query': query_result['query'],
                    'title': result.get('title'),
                    'link': result.get('link'),
                    'snippet': result.get('snippet'),
                    'has_2018': has_2018,
                    'is_clinicaltrials_gov': is_clinicaltrials
                })
            elif has_h_pylori and has_acne:
                potential_trials.append({
                    'query': query_result['query'],
                    'title': result.get('title'),
                    'link': result.get('link'),
                    'snippet': result.get('snippet'),
                    'has_2018': has_2018,
                    'is_clinicaltrials_gov': is_clinicaltrials
                })
            
            if is_clinicaltrials:
                clinicaltrials_gov_results.append({
                    'query': query_result['query'],
                    'title': result.get('title'),
                    'link': result.get('link'),
                    'snippet': result.get('snippet'),
                    'has_h_pylori': has_h_pylori,
                    'has_acne': has_acne,
                    'has_2018': has_2018
                })
            
            if has_2018 and (has_h_pylori or has_acne):
                date_specific_results.append({
                    'query': query_result['query'],
                    'title': result.get('title'),
                    'link': result.get('link'),
                    'snippet': result.get('snippet'),
                    'has_h_pylori': has_h_pylori,
                    'has_acne': has_acne
                })
    
    print(f"\nüìä CLINICAL TRIAL SEARCH SUMMARY:")
    print(f"Definitive clinical trial matches: {len(definitive_trials)}")
    print(f"Potential clinical trial matches: {len(potential_trials)}")
    print(f"ClinicalTrials.gov results: {len(clinicaltrials_gov_results)}")
    print(f"2018-specific results: {len(date_specific_results)}")
    
    # Display the most important findings
    if definitive_trials:
        print(f"\nüéØ DEFINITIVE CLINICAL TRIAL MATCHES:")
        for i, trial in enumerate(definitive_trials[:5], 1):
            print(f"  {i}. {trial['title']}")
            print(f"     URL: {trial['link']}")
            print(f"     ClinicalTrials.gov: {'YES' if trial['is_clinicaltrials_gov'] else 'NO'}")
            print(f"     Mentions 2018: {'YES' if trial['has_2018'] else 'NO'}")
            print(f"     Query: {trial['query']}")
            print(f"     Snippet: {trial['snippet'][:200]}...")
            print()
    
    if clinicaltrials_gov_results:
        print(f"\nüìã CLINICALTRIALS.GOV SPECIFIC RESULTS:")
        for i, result in enumerate(clinicaltrials_gov_results[:5], 1):
            print(f"  {i}. {result['title']}")
            print(f"     URL: {result['link']}")
            print(f"     H. pylori: {'YES' if result['has_h_pylori'] else 'NO'}")
            print(f"     Acne: {'YES' if result['has_acne'] else 'NO'}")
            print(f"     2018: {'YES' if result['has_2018'] else 'NO'}")
            print(f"     Snippet: {result['snippet'][:150]}...")
            print()
    
    if date_specific_results:
        print(f"\nüìÖ 2018-SPECIFIC RESULTS:")
        for i, result in enumerate(date_specific_results[:3], 1):
            print(f"  {i}. {result['title']}")
            print(f"     H. pylori: {'YES' if result['has_h_pylori'] else 'NO'}")
            print(f"     Acne: {'YES' if result['has_acne'] else 'NO'}")
            print(f"     Snippet: {result['snippet'][:150]}...")
            print()
    
    print(f"\n" + "=" * 80)
    print("CLINICAL TRIAL SEARCH STATUS")
    print("=" * 80)
    
    # Determine search success
    if definitive_trials:
        search_status = "‚úÖ SUCCESS - Clinical trials found matching both H. pylori and acne vulgaris"
        confidence = "HIGH"
        next_steps = "Examine specific trial details, registration dates, and study protocols"
    elif potential_trials:
        search_status = "‚ö†Ô∏è PARTIAL SUCCESS - Potential matches found requiring further investigation"
        confidence = "MEDIUM"
        next_steps = "Investigate potential matches and expand search terms if needed"
    elif clinicaltrials_gov_results:
        search_status = "üìã LIMITED SUCCESS - ClinicalTrials.gov results found but need verification"
        confidence = "MEDIUM-LOW"
        next_steps = "Examine ClinicalTrials.gov results for relevance to both conditions"
    else:
        search_status = "‚ùå LIMITED RESULTS - No clear clinical trial matches found"
        confidence = "LOW"
        next_steps = "Consider alternative search strategies or broader date ranges"
    
    print(f"\nüéØ SEARCH STATUS: {search_status}")
    print(f"Confidence Level: {confidence}")
    print(f"Recommended Next Steps: {next_steps}")
    
    # Save analysis summary
    analysis_summary = {
        'search_completed': True,
        'search_status': search_status,
        'confidence_level': confidence,
        'findings_summary': {
            'definitive_trials': len(definitive_trials),
            'potential_trials': len(potential_trials),
            'clinicaltrials_gov_results': len(clinicaltrials_gov_results),
            'date_specific_results': len(date_specific_results)
        },
        'key_findings': {
            'definitive_trials': definitive_trials[:5],
            'clinicaltrials_gov_results': clinicaltrials_gov_results[:5],
            'date_specific_results': date_specific_results[:3]
        },
        'next_steps': next_steps,
        'search_parameters': {
            'target_conditions': ['H. pylori', 'Helicobacter pylori', 'acne vulgaris', 'acne'],
            'target_timeframe': 'January-May 2018 (expanded)',
            'primary_database': 'ClinicalTrials.gov',
            'total_queries': len(clinical_trial_queries)
        }
    }
    
    summary_file = f"workspace/clinical_trial_search_analysis_{timestamp}.json"
    with open(summary_file, 'w', encoding='utf-8') as f:
        json.dump(analysis_summary, f, indent=2, ensure_ascii=False)
    
    print(f"\nAnalysis summary saved to: {summary_file}")
    print(f"Raw search data saved to: {results_file}")
    print("\nCLINICAL TRIAL SEARCH COMPLETED.")
```