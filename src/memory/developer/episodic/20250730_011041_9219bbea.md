### Development Step 2: Find Oldest Blu-Ray Title in Seattle Movie and Game Rental Excel Inventory

**Description**: Parse and analyze the attached Excel file data/gaia/2023/validation/32102e3e-d12a-4209-9163-7b3a104efe5d.xlsx to extract the complete inventory data for the Seattle movie and video game rental store. Identify the data structure including column headers, then filter the inventory to find all Blu-Ray items and determine which one has the oldest date (earliest release or acquisition date). Extract the exact title as it appears in the spreadsheet for the oldest Blu-Ray item.

**Use Cases**:
- Video rental chain inventory management: automate quarterly audits of Blu-Ray stock in Excel to identify the oldest titles for archival or promotional removal
- Media library archival process: parse donated Blu-Ray asset lists in Excel to prioritize the earliest release films for digitization projects
- E-commerce retailer stock optimization: extract Blu-Ray listings from supplier spreadsheets and pinpoint oldest stock for “Classic Collection” marketing campaigns
- Corporate training resource update: analyze Excel logs of employee training videos to filter Blu-Ray modules and flag outdated material for content refresh
- University film studies department research: process course film inventory spreadsheets to locate the earliest Blu-Ray editions for historical analysis
- Museum audiovisual archives monitoring: automate extraction of Blu-Ray entries from Excel catalogs to select the oldest recordings for preservation and digitization
- Home entertainment collector cataloging: filter personal spreadsheet inventories to find the very first acquired Blu-Ray disc for detailed collection tracking

```
import os
import pandas as pd
from openpyxl import load_workbook
import json
from datetime import datetime

# The path to the Excel file to be analyzed
xlsx_path = "data/gaia/2023/validation/32102e3e-d12a-4209-9163-7b3a104efe5d.xlsx"

print("=== EXTRACTING BLU-RAY ITEMS AND FINDING OLDEST ===")
print(f"Processing file: {xlsx_path}")

# Based on previous analysis, we know:
# - Row 3 contains the actual headers: ['Title', 'Genre', 'Year', 'Platform', 'Status']
# - Blu-Ray items start from row 12 onwards (after the 'Blu-Ray' section marker in row 11)
# - Year column contains the date information we need

# Load the Excel file using pandas with the correct header row
print("\nLoading Excel data with correct header row (row 3)...")

try:
    # Load the data using row 2 as header (0-based indexing)
    df = pd.read_excel(xlsx_path, header=2)
    
    print(f"Successfully loaded data with shape: {df.shape}")
    print(f"Column names: {list(df.columns)}")
    
    print("\n=== COMPLETE DATAFRAME CONTENT ===")
    print(df.to_string(index=False))
    
    print("\n=== IDENTIFYING BLU-RAY SECTION ===")
    
    # Find the row index where 'Blu-Ray' appears in the Title column
    blu_ray_section_idx = None
    for idx, row in df.iterrows():
        if str(row['Title']).strip() == 'Blu-Ray':
            blu_ray_section_idx = idx
            print(f"Found 'Blu-Ray' section marker at index: {idx}")
            break
    
    if blu_ray_section_idx is not None:
        # Extract Blu-Ray items (rows after the 'Blu-Ray' marker)
        blu_ray_items = df.iloc[blu_ray_section_idx + 1:].copy()
        
        # Remove any rows that might be empty or contain section markers
        blu_ray_items = blu_ray_items.dropna(subset=['Title'])
        blu_ray_items = blu_ray_items[blu_ray_items['Title'].str.strip() != '']
        
        print(f"\n=== EXTRACTED BLU-RAY ITEMS ({len(blu_ray_items)} items) ===")
        
        for idx, item in blu_ray_items.iterrows():
            title = item['Title']
            genre = item['Genre']
            year = item['Year']
            status = item['Status']
            print(f"  {title} ({year}) - {genre} - {status}")
        
        print("\n=== FINDING OLDEST BLU-RAY ITEM ===")
        
        # Convert Year column to numeric for comparison
        blu_ray_items['Year_numeric'] = pd.to_numeric(blu_ray_items['Year'], errors='coerce')
        
        print("Year values and their types:")
        for idx, item in blu_ray_items.iterrows():
            title = item['Title']
            year_orig = item['Year']
            year_numeric = item['Year_numeric']
            print(f"  {title}: {year_orig} -> {year_numeric} ({type(year_numeric)})")
        
        # Remove any items with invalid year data
        valid_blu_ray_items = blu_ray_items.dropna(subset=['Year_numeric'])
        
        if len(valid_blu_ray_items) > 0:
            print(f"\nValid Blu-Ray items with year data: {len(valid_blu_ray_items)}")
            
            # Find the item with the minimum (oldest) year
            oldest_item = valid_blu_ray_items.loc[valid_blu_ray_items['Year_numeric'].idxmin()]
            
            oldest_title = oldest_item['Title']
            oldest_year = oldest_item['Year_numeric']
            oldest_genre = oldest_item['Genre']
            oldest_status = oldest_item['Status']
            
            print("\n" + "="*60)
            print("OLDEST BLU-RAY ITEM FOUND")
            print("="*60)
            
            print(f"Title: {oldest_title}")
            print(f"Year: {int(oldest_year)}")
            print(f"Genre: {oldest_genre}")
            print(f"Status: {oldest_status}")
            
            print("\n*** FINAL ANSWER ***")
            print(f"The oldest Blu-Ray item in the Seattle rental store inventory is:")
            print(f"'{oldest_title}'")
            print(f"Released in: {int(oldest_year)}")
            
            # Verify by showing all Blu-Ray items sorted by year
            print("\n=== VERIFICATION: ALL BLU-RAY ITEMS SORTED BY YEAR ===")
            sorted_items = valid_blu_ray_items.sort_values('Year_numeric')
            
            for idx, item in sorted_items.iterrows():
                title = item['Title']
                year = int(item['Year_numeric'])
                genre = item['Genre']
                marker = " <-- OLDEST" if item.name == oldest_item.name else ""
                print(f"  {year}: {title} ({genre}){marker}")
            
            # Save results to workspace
            results = {
                'oldest_blu_ray_item': {
                    'title': oldest_title,
                    'year': int(oldest_year),
                    'genre': oldest_genre,
                    'status': oldest_status
                },
                'all_blu_ray_items': [],
                'analysis_timestamp': datetime.now().isoformat()
            }
            
            # Add all Blu-Ray items to results
            for idx, item in sorted_items.iterrows():
                item_data = {
                    'title': item['Title'],
                    'year': int(item['Year_numeric']),
                    'genre': item['Genre'],
                    'status': item['Status']
                }
                results['all_blu_ray_items'].append(item_data)
            
            with open('workspace/oldest_blu_ray_analysis.json', 'w') as f:
                json.dump(results, f, indent=2)
            
            print(f"\nDetailed analysis saved to: workspace/oldest_blu_ray_analysis.json")
            
            # Also save the Blu-Ray items as CSV
            valid_blu_ray_items.to_csv('workspace/blu_ray_items.csv', index=False)
            print(f"Blu-Ray items data saved to: workspace/blu_ray_items.csv")
            
        else:
            print("Error: No valid Blu-Ray items with year information found")
    
    else:
        print("Error: Could not find 'Blu-Ray' section marker in the data")
        print("Available Title values:")
        for idx, title in enumerate(df['Title'].head(15)):
            print(f"  Row {idx}: '{title}'")

except Exception as e:
    print(f"Error processing Excel file: {e}")
    print("\nAttempting manual parsing...")
    
    # Fallback: manual parsing with openpyxl
    wb = load_workbook(xlsx_path, data_only=True)
    sheet = wb.active
    
    print(f"\nManual parsing - Sheet dimensions: {sheet.max_row} x {sheet.max_column}")
    
    # Find Blu-Ray section manually
    blu_ray_start_row = None
    for row in range(1, sheet.max_row + 1):
        cell_value = sheet.cell(row=row, column=1).value
        if cell_value and str(cell_value).strip() == 'Blu-Ray':
            blu_ray_start_row = row
            print(f"Found Blu-Ray section at row: {row}")
            break
    
    if blu_ray_start_row:
        print("\nExtracting Blu-Ray items manually:")
        blu_ray_items_manual = []
        
        for row in range(blu_ray_start_row + 1, sheet.max_row + 1):
            title = sheet.cell(row=row, column=1).value
            genre = sheet.cell(row=row, column=2).value
            year = sheet.cell(row=row, column=3).value
            platform = sheet.cell(row=row, column=4).value
            status = sheet.cell(row=row, column=5).value
            
            if title and str(title).strip():
                blu_ray_items_manual.append({
                    'title': str(title),
                    'genre': str(genre) if genre else '',
                    'year': year,
                    'platform': str(platform) if platform else '',
                    'status': str(status) if status else ''
                })
                print(f"  {title} ({year}) - {genre}")
        
        if blu_ray_items_manual:
            # Find oldest
            oldest_manual = min(blu_ray_items_manual, key=lambda x: float(x['year']) if x['year'] else float('inf'))
            print(f"\n*** MANUAL PARSING RESULT ***")
            print(f"Oldest Blu-Ray item: '{oldest_manual['title']}'")
            print(f"Year: {oldest_manual['year']}")

print("\n=== ANALYSIS COMPLETE ===")
```