### Development Step 17: Washington State’s Largest and Smallest County Seats by Land Area and Their 2020 Populations

**Description**: Identify the largest and smallest county seats by land area from the complete dataset of 39 Washington state county seats with their land area measurements. Then extract the 2020 census population data for these two specific county seats using the official data.census.gov source as specified in the TASK.

**Use Cases**:
- State urban planning and infrastructure design for Washington by calculating population density in the smallest (Cathlamet) and largest (Seattle) county seats to guide transportation and utility investments
- Emergency management resource allocation by automating land‐area and 2020 population retrieval for extreme county seats to optimize rural vs. urban first-responder deployment
- Real estate investment analysis comparing development potential in a micro-market (Cathlamet) versus a major metro (Seattle) using standardized land-area and census population data
- Environmental impact modeling by simulating urban sprawl and green‐space ratios in Washington’s smallest and largest county seats based on official area and population figures
- Tourism marketing segmentation that tailors promotional campaigns according to visitor density insights derived from land area and 2020 population of Cathlamet and Seattle
- Data journalism and storytelling visualizing how extreme land-area county seats correlate with population patterns across Washington, with narrative focus on Cathlamet vs. Seattle
- GIS dashboard automation for public portals automatically ingesting land‐area and census data for Cathlamet and Seattle to generate dynamic density and resource‐allocation maps
- Academic demographic research case studies comparing shifts in population distribution and urbanization trends between a tiny county seat and the state’s largest city using API-sourced census statistics

```
import os
import json
import requests
import time
from urllib.parse import quote

# First, let's inspect the extreme cities data file to understand its structure
print("=== Inspecting Extreme Cities Data File ===")
extreme_cities_path = os.path.join('workspace', 'extreme_county_seats.json')

if os.path.exists(extreme_cities_path):
    with open(extreme_cities_path, 'r', encoding='utf-8') as f:
        extreme_cities = json.load(f)
    
    print(f"File structure: {type(extreme_cities)}")
    print(f"Keys: {list(extreme_cities.keys()) if isinstance(extreme_cities, dict) else 'Not a dict'}")
    print(f"Content preview: {extreme_cities}")
else:
    print(f"File {extreme_cities_path} not found. Using data from previous analysis.")
    # Fallback data from the previous step
    extreme_cities = {
        'smallest': {
            'city': 'Cathlamet',
            'county': 'Wahkiakum County',
            'land_area': 0.51,
            'fips_code': '069'
        },
        'largest': {
            'city': 'Seattle',
            'county': 'King County',
            'land_area': 142.07,
            'fips_code': '033'
        }
    }

print(f"\n=== Extracting 2020 Census Population Data ===")
print(f"Target cities:")
print(f"- Smallest: {extreme_cities['smallest']['city']}, {extreme_cities['smallest']['county']}")
print(f"- Largest: {extreme_cities['largest']['city']}, {extreme_cities['largest']['county']}")

# Function to get 2020 census population data from data.census.gov API
def get_census_population(city_name, state_code='53', county_fips=None):
    """
    Get 2020 census population data for a city using the official Census API
    Washington state FIPS code is 53
    """
    print(f"\nQuerying Census API for {city_name}...")
    
    # Census API endpoint for 2020 Decennial Census
    base_url = "https://api.census.gov/data/2020/dec/pl"
    
    # Population variable: P1_001N (Total Population)
    variables = "P1_001N,NAME"
    
    # Try different geographic levels to find the city
    geographic_queries = []
    
    if county_fips:
        # Try place within specific county
        geographic_queries.append(f"place:*&in=state:{state_code}%20county:{county_fips.zfill(3)}")
    
    # Try place within state (broader search)
    geographic_queries.append(f"place:*&in=state:{state_code}")
    
    for geo_query in geographic_queries:
        try:
            url = f"{base_url}?get={variables}&for={geo_query}"
            print(f"Trying URL: {url}")
            
            response = requests.get(url)
            print(f"Response status: {response.status_code}")
            
            if response.status_code == 200:
                data = response.json()
                print(f"Found {len(data)-1} places in response")
                
                # Search for our city in the results
                for row in data[1:]:  # Skip header row
                    place_name = row[1]  # NAME column
                    population = row[0]  # P1_001N column
                    
                    # Check if this is our target city
                    if city_name.lower() in place_name.lower():
                        print(f"Match found: {place_name} - Population: {population}")
                        return {
                            'city': city_name,
                            'census_name': place_name,
                            'population_2020': int(population),
                            'source': 'U.S. Census Bureau 2020 Decennial Census',
                            'api_url': url
                        }
                        
            time.sleep(0.5)  # Be respectful to the API
            
        except Exception as e:
            print(f"Error querying census API: {e}")
            continue
    
    return None

# Get population data for both cities
results = {}

# Get data for smallest city (Cathlamet)
smallest_city = extreme_cities['smallest']['city']
smallest_county_fips = extreme_cities['smallest']['fips_code']
print(f"\n=== Getting Census Data for {smallest_city} ===")
results['smallest'] = get_census_population(smallest_city, county_fips=smallest_county_fips)
if results['smallest']:
    print(f"✓ Found population data for {smallest_city}: {results['smallest']['population_2020']:,}")
else:
    print(f"✗ Could not find census data for {smallest_city}")

# Get data for largest city (Seattle)
largest_city = extreme_cities['largest']['city']
largest_county_fips = extreme_cities['largest']['fips_code']
print(f"\n=== Getting Census Data for {largest_city} ===")
results['largest'] = get_census_population(largest_city, county_fips=largest_county_fips)
if results['largest']:
    print(f"✓ Found population data for {largest_city}: {results['largest']['population_2020']:,}")
else:
    print(f"✗ Could not find census data for {largest_city}")

# Combine all results
final_results = {
    'analysis_timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
    'objective': 'Washington state county seats - largest and smallest by land area with 2020 census population',
    'smallest_county_seat': {
        'city': extreme_cities['smallest']['city'],
        'county': extreme_cities['smallest']['county'],
        'land_area_sq_miles': extreme_cities['smallest']['land_area'],
        'population_2020': results['smallest']['population_2020'] if results['smallest'] else None,
        'census_official_name': results['smallest']['census_name'] if results['smallest'] else None
    },
    'largest_county_seat': {
        'city': extreme_cities['largest']['city'],
        'county': extreme_cities['largest']['county'],
        'land_area_sq_miles': extreme_cities['largest']['land_area'],
        'population_2020': results['largest']['population_2020'] if results['largest'] else None,
        'census_official_name': results['largest']['census_name'] if results['largest'] else None
    },
    'data_sources': {
        'land_area': 'Wikipedia (U.S. Census Bureau data)',
        'population': 'U.S. Census Bureau 2020 Decennial Census API (data.census.gov)'
    }
}

# Save final results
with open('workspace/wa_county_seats_final_analysis.json', 'w') as f:
    json.dump(final_results, f, indent=2)

print(f"\n=== FINAL RESULTS ===")
print(f"SMALLEST County Seat by Land Area:")
print(f"  City: {final_results['smallest_county_seat']['city']}")
print(f"  County: {final_results['smallest_county_seat']['county']}")
print(f"  Land Area: {final_results['smallest_county_seat']['land_area_sq_miles']} sq miles")
print(f"  2020 Population: {final_results['smallest_county_seat']['population_2020']:,}" if final_results['smallest_county_seat']['population_2020'] else "  2020 Population: Data not found")

print(f"\nLARGEST County Seat by Land Area:")
print(f"  City: {final_results['largest_county_seat']['city']}")
print(f"  County: {final_results['largest_county_seat']['county']}")
print(f"  Land Area: {final_results['largest_county_seat']['land_area_sq_miles']} sq miles")
print(f"  2020 Population: {final_results['largest_county_seat']['population_2020']:,}" if final_results['largest_county_seat']['population_2020'] else "  2020 Population: Data not found")

print(f"\nFinal analysis saved to workspace/wa_county_seats_final_analysis.json")
print(f"Data sources: Land area from Wikipedia (Census data), Population from official data.census.gov API")
```