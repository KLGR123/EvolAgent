### Development Step 31: 2011 Bulgarian NSI Census Tertiary Education Completion Counts by Gender

**Description**: Search for the official 2011 Bulgarian census data from the Bulgarian National Statistical Institute (NSI) or other authoritative government sources that specifically contain the tertiary education completion numbers by gender. Focus on finding the exact counts or percentages of men and women who completed tertiary education according to the 2011 census results.

**Use Cases**:
- Government policy analysis and demographic reporting for the Ministry of Education, using 2011 census data to inform strategic plans on tertiary enrollment by gender
- Academic research on gender disparities in higher education, extracting exact completion counts from NSI census tables for peer-reviewed publications
- NGO program planning and impact evaluation on female tertiary enrollment in rural Bulgaria, leveraging official 2011 statistics to target interventions
- Data engineering pipeline automation for ingesting and normalizing NSI census tables into a centralized analytics database
- Journalistic fact-checking and interactive visualization of 2011 tertiary education completion rates by gender for news articles
- International development consulting on gender equality benchmarks, comparing Bulgaria’s census figures against EU standards
- University institutional research office compiling longitudinal studies of graduate demographics, combining past census data with current enrolment records
- Open data platform curation and quality validation of statistical findings, ensuring accurate public access to gender-segmented education metrics

```
import os
import json
from bs4 import BeautifulSoup
import re

# Define the recursive search function BEFORE using it
def find_data_recursively(obj, path=""):
    findings = []
    if isinstance(obj, dict):
        for key, value in obj.items():
            current_path = f"{path}.{key}" if path else key
            
            # Check if this key might contain relevant data
            key_lower = key.lower()
            if any(term in key_lower for term in ['gender', 'male', 'female', 'men', 'women', 'tertiary', 'education', 'university', 'higher']):
                findings.append((current_path, type(value), str(value)[:300]))
            
            # Recurse into nested structures
            findings.extend(find_data_recursively(value, current_path))
    
    elif isinstance(obj, list):
        for i, item in enumerate(obj):
            current_path = f"{path}[{i}]"
            findings.extend(find_data_recursively(item, current_path))
    
    elif isinstance(obj, str):
        # Look for numerical patterns in strings
        if re.search(r'\d+', obj) and any(term in obj.lower() for term in ['education', 'tertiary', 'university', 'male', 'female', 'gender']):
            findings.append((path, "string_with_numbers", obj[:300]))
    
    return findings

# Now examine the most promising JSON file
workspace_dir = 'workspace'
promising_file = 'bulgarian_census_tertiary_education_comprehensive_final.json'
filepath = os.path.join(workspace_dir, promising_file)

print("=== EXTRACTING 2011 BULGARIAN CENSUS TERTIARY EDUCATION DATA BY GENDER ===")
print(f"\nAnalyzing: {promising_file}\n")

if os.path.exists(filepath):
    with open(filepath, 'r', encoding='utf-8') as f:
        data = json.load(f)
    
    print("=== EXAMINING DETAILED DATA STRUCTURE ===")
    
    # Focus on the detailed_data section which contains the actual findings
    if 'detailed_data' in data and isinstance(data['detailed_data'], dict):
        detailed_data = data['detailed_data']
        print(f"\nDetailed data sections: {list(detailed_data.keys())}")
        
        # Examine tertiary_education_data
        if 'tertiary_education_data' in detailed_data:
            tertiary_data = detailed_data['tertiary_education_data']
            print(f"\n--- TERTIARY EDUCATION DATA ---")
            print(f"Number of tertiary education entries: {len(tertiary_data)}")
            
            for i, entry in enumerate(tertiary_data, 1):
                print(f"\nEntry {i}:")
                print(f"  Match text: {entry.get('match_text', 'N/A')}")
                print(f"  Has gender data: {entry.get('has_gender', False)}")
                print(f"  Has 2011 data: {entry.get('has_2011', False)}")
                print(f"  Has Bulgaria data: {entry.get('has_bulgaria', False)}")
                
                # Extract specific numbers from the match text
                match_text = entry.get('match_text', '')
                if match_text:
                    # Look for patterns like "male: X years" or "female: X years"
                    male_pattern = re.search(r'male:\s*(\d+)', match_text, re.IGNORECASE)
                    female_pattern = re.search(r'female:\s*(\d+)', match_text, re.IGNORECASE)
                    total_pattern = re.search(r'total:\s*(\d+)', match_text, re.IGNORECASE)
                    
                    if male_pattern or female_pattern or total_pattern:
                        print(f"  *** NUMERICAL DATA EXTRACTED ***")
                        if total_pattern:
                            print(f"    Total: {total_pattern.group(1)}")
                        if male_pattern:
                            print(f"    Male: {male_pattern.group(1)}")
                        if female_pattern:
                            print(f"    Female: {female_pattern.group(1)}")
        
        # Examine statistical_findings
        if 'statistical_findings' in detailed_data:
            stat_findings = detailed_data['statistical_findings']
            print(f"\n--- STATISTICAL FINDINGS ---")
            print(f"Number of statistical findings: {len(stat_findings)}")
            
            for i, finding in enumerate(stat_findings, 1):
                print(f"\nFinding {i}:")
                print(f"  Type: {finding.get('type', 'N/A')}")
                print(f"  Gender: {finding.get('gender', 'N/A')}")
                print(f"  Value: {finding.get('value', 'N/A')}")
                print(f"  Unit: {finding.get('unit', 'N/A')}")
                
                # Check if this is tertiary education related
                finding_type = finding.get('type', '').lower()
                if 'education' in finding_type or 'tertiary' in finding_type:
                    print(f"  *** EDUCATION-RELATED FINDING ***")
        
        # Examine census_2011_findings
        if 'census_2011_findings' in detailed_data:
            census_findings = detailed_data['census_2011_findings']
            print(f"\n--- 2011 CENSUS FINDINGS ---")
            print(f"Number of census findings: {len(census_findings)}")
            
            for i, finding in enumerate(census_findings, 1):
                print(f"\nCensus Finding {i}:")
                print(f"  Census text: {finding.get('census_text', 'N/A')}")
                
                # Look for education-related census data
                census_text = finding.get('census_text', '').lower()
                if any(term in census_text for term in ['education', 'tertiary', 'university', 'degree']):
                    print(f"  *** EDUCATION-RELATED CENSUS DATA ***")
                    
                    # Extract numbers from census text
                    numbers = re.findall(r'\b\d{1,3}(?:,\d{3})*\b', finding.get('census_text', ''))
                    if numbers:
                        print(f"  Numbers found: {numbers}")
    
    print(f"\n=== RECURSIVE SEARCH FOR ALL RELEVANT DATA ===\n")
    
    # Use the recursive function to find all relevant data
    relevant_findings = find_data_recursively(data)
    
    if relevant_findings:
        print("All relevant gender/education data found:")
        for path, data_type, content in relevant_findings:
            print(f"\nPath: {path}")
            print(f"Type: {data_type}")
            print(f"Content: {content}")
            
            # If this contains numerical data, try to extract it
            if 'male' in content.lower() and 'female' in content.lower():
                print(f"  *** CONTAINS GENDER-SPECIFIC DATA ***")
                
                # Extract all numbers from this content
                numbers = re.findall(r'\b\d+(?:\.\d+)?\b', content)
                if numbers:
                    print(f"  Numbers extracted: {numbers}")
    else:
        print("No relevant gender/education data found through recursive search.")
    
    print(f"\n=== SUMMARY OF FINDINGS ===\n")
    
    # Summarize what we found
    summary = {
        'source_file': data.get('source_file', 'Unknown'),
        'analysis_timestamp': data.get('analysis_timestamp', 'Unknown'),
        'tertiary_education_matches': data.get('tertiary_education_matches', 0),
        'statistical_findings_count': data.get('statistical_findings', 0),
        'census_2011_findings_count': data.get('census_2011_findings', 0)
    }
    
    print("Analysis Summary:")
    for key, value in summary.items():
        print(f"  {key}: {value}")
    
    # Check if we found actual tertiary education completion data by gender
    found_tertiary_gender_data = False
    
    if 'detailed_data' in data and 'statistical_findings' in data['detailed_data']:
        for finding in data['detailed_data']['statistical_findings']:
            if (finding.get('type', '').lower() in ['years_of_education', 'education_level'] and 
                finding.get('gender') in ['male', 'female']):
                found_tertiary_gender_data = True
                break
    
    if found_tertiary_gender_data:
        print(f"\n✓ SUCCESS: Found tertiary education data by gender from 2011 Bulgarian census")
    else:
        print(f"\n✗ The data found appears to be school life expectancy (years of education) rather than")
        print(f"  specific tertiary education completion numbers/percentages by gender.")
        print(f"\n  The data shows:")
        print(f"  - School life expectancy (primary to tertiary): 14 years for both males and females (2016 data)")
        print(f"  - This is NOT the same as tertiary education completion rates from 2011 census")
        
        print(f"\n=== RECOMMENDATION ===\n")
        print(f"The current data is from Wikipedia Demographics page and contains school life expectancy")
        print(f"rather than actual 2011 census tertiary education completion statistics.")
        print(f"Need to search for official NSI (Bulgarian National Statistical Institute) census tables")
        print(f"that specifically show tertiary education completion by gender from the 2011 census.")

else:
    print(f"File not found: {filepath}")

# Save our analysis results
analysis_results = {
    'objective': '2011 Bulgarian Census - Tertiary Education Completion by Gender',
    'analysis_timestamp': '2025-01-11',
    'file_analyzed': promising_file,
    'data_type_found': 'School life expectancy (years of education)',
    'actual_target_found': False,
    'recommendation': 'Search official NSI census tables for tertiary education completion rates by gender',
    'data_source': 'Wikipedia Demographics of Bulgaria page',
    'data_year': '2016 (not 2011 census)',
    'values_found': {
        'total_school_life_expectancy': '14 years',
        'male_school_life_expectancy': '14 years', 
        'female_school_life_expectancy': '14 years'
    }
}

results_file = os.path.join(workspace_dir, 'bulgarian_census_analysis_final_results.json')
with open(results_file, 'w', encoding='utf-8') as f:
    json.dump(analysis_results, f, indent=2, ensure_ascii=False)

print(f"\nAnalysis results saved to: {results_file}")
print(f"\nNext step: Search for official NSI census tables with actual tertiary education completion data by gender from 2011.")
```