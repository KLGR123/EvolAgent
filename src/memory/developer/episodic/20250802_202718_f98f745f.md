### Development Step 23: Locate Official 2011 Bulgarian Census Data on Tertiary Education Completion by Gender

**Description**: Search for the 2011 Bulgarian census data on tertiary education completion by gender. Look for official census results from Bulgaria's National Statistical Institute or other authoritative sources that provide the specific breakdown of men and women who completed tertiary education in 2011.

**Use Cases**:
- Government policy development: automated extraction of 2011 Bulgarian census tertiary‐education data by gender to design targeted scholarship and workforce programs
- Academic research on gender parity: bulk‐parse official HTML archives to compile male/female university completion rates for longitudinal social studies
- NGO reporting and grant writing: retrieve precise tertiary‐education statistics from national census pages to substantiate gender‐empowerment proposals
- Data journalism dashboards: scrape and normalize gender‐disaggregated education figures from Bulgarian census HTML for interactive news visualizations
- Market analysis for education providers: mine regional male vs. female tertiary attainment data to plan new university campuses and online course offerings
- Health workforce forecasting: extract and model the gender split of university‐educated professionals from 2011 census content to predict medical staffing needs
- Historical demographic comparison: systematically harvest 2011 tertiary‐education statistics by gender to benchmark against later censuses in population studies
- Government open‐data ETL pipelines: integrate regex‐based HTML parsing of Bulgarian census pages into data warehouses for public access and policy analytics

```
import os
import json
from bs4 import BeautifulSoup
import re
import time

print("=== BULGARIAN 2011 CENSUS TERTIARY EDUCATION BY GENDER - FINAL ROBUST EXTRACTION ===")
print("Strategy: Completely explicit variable handling to avoid all scoping issues\n")

# Check workspace
workspace_path = 'workspace'
if not os.path.exists(workspace_path):
    print("No workspace directory found")
    exit()

# Get all files
all_files = os.listdir(workspace_path)
print(f"Total files in workspace: {len(all_files)}")

# Find HTML files using explicit loop
html_files_found = []
for single_file in all_files:
    if single_file.endswith('.html'):
        html_files_found.append(single_file)

print(f"HTML files found: {len(html_files_found)}")

# Find Bulgarian Demographics files using explicit loop
bulgarian_files = []
for html_file in html_files_found:
    if 'Demographics_of_Bulgaria' in html_file:
        bulgarian_files.append(html_file)
        print(f"  Found Bulgarian Demographics file: {html_file}")

if len(bulgarian_files) == 0:
    print("No Bulgarian Demographics files found")
    exit()

# Use the first Bulgarian Demographics file
target_file = bulgarian_files[0]
print(f"\n=== ANALYZING: {target_file} ===")

# Read the file
filepath = os.path.join(workspace_path, target_file)
with open(filepath, 'r', encoding='utf-8') as f:
    html_content = f.read()

print(f"File size: {len(html_content):,} characters")

# Parse HTML
soup = BeautifulSoup(html_content, 'html.parser')
page_title_element = soup.find('title')
if page_title_element:
    page_title_text = page_title_element.get_text().strip()
    print(f"Page title: {page_title_text}")

# Extract all text
all_text_content = soup.get_text()
print(f"Text content: {len(all_text_content):,} characters")

# Search for tertiary education data - using explicit variables
print("\n=== SEARCHING FOR TERTIARY EDUCATION DATA ===")

all_education_matches = []

# Pattern 1: Look for "tertiary education" followed by gender data
pattern_1 = r'tertiary education[^.]{0,500}(?:male|female|men|women)[^.]{0,200}'
pattern_1_matches = re.finditer(pattern_1, all_text_content, re.IGNORECASE | re.DOTALL)

for single_match in pattern_1_matches:
    match_start = single_match.start()
    match_end = single_match.end()
    
    context_start_pos = max(0, match_start - 200)
    context_end_pos = min(len(all_text_content), match_end + 200)
    match_context = all_text_content[context_start_pos:context_end_pos]
    
    match_info = {
        'type': 'tertiary_education_with_gender',
        'match_text': single_match.group(),
        'context': match_context
    }
    all_education_matches.append(match_info)

print(f"Tertiary education with gender matches: {len(all_education_matches)}")

# Pattern 2: Look for education statistics with percentages and gender
pattern_2 = r'(?:male|female|men|women)[^.]{0,100}(?:education|tertiary|university)[^.]{0,100}(\\d+\\.?\\d*\\s*%?)'
pattern_2_matches = re.finditer(pattern_2, all_text_content, re.IGNORECASE)

for single_match_2 in pattern_2_matches:
    match_start_2 = single_match_2.start()
    match_end_2 = single_match_2.end()
    
    context_start_pos_2 = max(0, match_start_2 - 200)
    context_end_pos_2 = min(len(all_text_content), match_end_2 + 200)
    match_context_2 = all_text_content[context_start_pos_2:context_end_pos_2]
    
    match_groups = single_match_2.groups()
    percentage_value = match_groups[0] if match_groups else 'No percentage'
    
    match_info_2 = {
        'type': 'gender_education_statistics',
        'match_text': single_match_2.group(),
        'percentage': percentage_value,
        'context': match_context_2
    }
    all_education_matches.append(match_info_2)

print(f"Total education matches so far: {len(all_education_matches)}")

# Pattern 3: Look for 2011 census data with education
pattern_3 = r'2011[^.]{0,300}(?:education|tertiary|university)[^.]{0,200}(?:male|female|men|women)[^.]{0,100}'
pattern_3_matches = re.finditer(pattern_3, all_text_content, re.IGNORECASE | re.DOTALL)

for single_match_3 in pattern_3_matches:
    match_start_3 = single_match_3.start()
    match_end_3 = single_match_3.end()
    
    context_start_pos_3 = max(0, match_start_3 - 200)
    context_end_pos_3 = min(len(all_text_content), match_end_3 + 200)
    match_context_3 = all_text_content[context_start_pos_3:context_end_pos_3]
    
    match_info_3 = {
        'type': '2011_census_education',
        'match_text': single_match_3.group(),
        'context': match_context_3
    }
    all_education_matches.append(match_info_3)

print(f"Final total education matches: {len(all_education_matches)}")

# Display all matches found
if len(all_education_matches) > 0:
    print("\n=== EDUCATION MATCHES FOUND ===")
    for match_index in range(len(all_education_matches)):
        current_match = all_education_matches[match_index]
        match_number = match_index + 1
        
        print(f"\nMatch {match_number} ({current_match['type']}):")
        match_text_preview = current_match['match_text'][:200] + '...' if len(current_match['match_text']) > 200 else current_match['match_text']
        print(f"  Text: {match_text_preview}")
        
        if 'percentage' in current_match:
            print(f"  Percentage: {current_match['percentage']}")
        
        context_preview = current_match['context'][:300] + '...' if len(current_match['context']) > 300 else current_match['context']
        print(f"  Context: {context_preview}")
        print()

# Look for specific numerical data in education context
print("\n=== EXTRACTING NUMERICAL DATA ===")

all_numerical_findings = []

# Search for years of education by gender
years_pattern = r'(?:male|female|men|women)[^.]{0,50}(\\d+)\\s*years?[^.]{0,50}(?:education|tertiary)'
years_matches = re.finditer(years_pattern, all_text_content, re.IGNORECASE)

for years_match in years_matches:
    years_start = years_match.start()
    years_end = years_match.end()
    
    years_context_start = max(0, years_start - 150)
    years_context_end = min(len(all_text_content), years_end + 150)
    years_context = all_text_content[years_context_start:years_context_end]
    
    years_groups = years_match.groups()
    years_value = years_groups[0] if years_groups else 'No value'
    
    years_finding = {
        'type': 'years_of_education',
        'value': years_value,
        'context': years_context
    }
    all_numerical_findings.append(years_finding)

# Search for percentage data with gender in education context
percentage_pattern = r'(?:male|female|men|women)[^.]{0,100}(\\d+\\.?\\d*)\\s*%'
percentage_matches = re.finditer(percentage_pattern, all_text_content, re.IGNORECASE)

for percentage_match in percentage_matches:
    perc_start = percentage_match.start()
    perc_end = percentage_match.end()
    
    perc_context_start = max(0, perc_start - 150)
    perc_context_end = min(len(all_text_content), perc_end + 150)
    perc_context = all_text_content[perc_context_start:perc_context_end]
    
    # Check if context mentions education using explicit loop
    education_terms = ['education', 'tertiary', 'university', 'degree']
    has_education_term = False
    perc_context_lower = perc_context.lower()
    
    for edu_term in education_terms:
        if edu_term in perc_context_lower:
            has_education_term = True
            break
    
    if has_education_term:
        perc_groups = percentage_match.groups()
        perc_value = perc_groups[0] if perc_groups else 'No value'
        
        perc_finding = {
            'type': 'education_percentage',
            'value': perc_value,
            'context': perc_context
        }
        all_numerical_findings.append(perc_finding)

print(f"Numerical findings: {len(all_numerical_findings)}")

for finding_index in range(len(all_numerical_findings)):
    current_finding = all_numerical_findings[finding_index]
    finding_number = finding_index + 1
    
    print(f"\nFinding {finding_number} ({current_finding['type']}):")
    print(f"  Value: {current_finding['value']}")
    finding_context_preview = current_finding['context'][:250] + '...' if len(current_finding['context']) > 250 else current_finding['context']
    print(f"  Context: {finding_context_preview}")

# Look for specific Bulgarian census data
print("\n=== SEARCHING FOR BULGARIAN CENSUS DATA ===")

all_bulgarian_census_data = []

# Search for Bulgaria + 2011 + education combinations
bulgaria_2011_pattern = r'(?:bulgaria|bulgarian)[^.]{0,200}2011[^.]{0,200}(?:education|tertiary|university)[^.]{0,200}'
bulgaria_matches = re.finditer(bulgaria_2011_pattern, all_text_content, re.IGNORECASE | re.DOTALL)

for bulgaria_match in bulgaria_matches:
    bulgaria_start = bulgaria_match.start()
    bulgaria_end = bulgaria_match.end()
    
    bulgaria_context_start = max(0, bulgaria_start - 300)
    bulgaria_context_end = min(len(all_text_content), bulgaria_end + 300)
    bulgaria_context = all_text_content[bulgaria_context_start:bulgaria_context_end]
    
    # Extract any numbers from this context
    numbers_in_context = re.findall(r'\\d+\\.?\\d*\\s*%?', bulgaria_context)
    
    bulgaria_data = {
        'match_text': bulgaria_match.group(),
        'context': bulgaria_context,
        'numbers_found': numbers_in_context
    }
    all_bulgarian_census_data.append(bulgaria_data)

print(f"Bulgarian census data matches: {len(all_bulgarian_census_data)}")

for data_index in range(len(all_bulgarian_census_data)):
    current_data = all_bulgarian_census_data[data_index]
    data_number = data_index + 1
    
    print(f"\nBulgarian Census Data {data_number}:")
    match_preview = current_data['match_text'][:150] + '...' if len(current_data['match_text']) > 150 else current_data['match_text']
    print(f"  Match: {match_preview}")
    print(f"  Numbers found: {current_data['numbers_found']}")
    context_preview = current_data['context'][:300] + '...' if len(current_data['context']) > 300 else current_data['context']
    print(f"  Context: {context_preview}")

# Save comprehensive results
final_results = {
    'objective': 'Bulgarian 2011 census tertiary education completion by gender',
    'analysis_timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
    'file_analyzed': target_file,
    'education_matches_found': len(all_education_matches),
    'numerical_findings_found': len(all_numerical_findings),
    'bulgarian_census_matches': len(all_bulgarian_census_data),
    'detailed_results': {
        'education_matches': all_education_matches,
        'numerical_findings': all_numerical_findings,
        'bulgarian_census_data': all_bulgarian_census_data
    }
}

# Count specific types using explicit loops
tertiary_education_count = 0
gender_statistics_count = 0
census_2011_count = 0
years_education_count = 0
education_percentage_count = 0

for match in all_education_matches:
    if match['type'] == 'tertiary_education_with_gender':
        tertiary_education_count += 1
    elif match['type'] == 'gender_education_statistics':
        gender_statistics_count += 1
    elif match['type'] == '2011_census_education':
        census_2011_count += 1

for finding in all_numerical_findings:
    if finding['type'] == 'years_of_education':
        years_education_count += 1
    elif finding['type'] == 'education_percentage':
        education_percentage_count += 1

final_results['summary'] = {
    'tertiary_education_references': tertiary_education_count,
    'gender_statistics': gender_statistics_count,
    'census_2011_references': census_2011_count,
    'years_of_education_data': years_education_count,
    'education_percentages': education_percentage_count
}

results_file = os.path.join(workspace_path, 'bulgarian_census_final_robust_results.json')
with open(results_file, 'w', encoding='utf-8') as f:
    json.dump(final_results, f, indent=2, ensure_ascii=False)

print(f"\n=== FINAL SUMMARY ===")
print(f"Results saved to: {results_file}")
print(f"Education matches found: {final_results['education_matches_found']}")
print(f"Numerical findings: {final_results['numerical_findings_found']}")
print(f"Bulgarian census matches: {final_results['bulgarian_census_matches']}")

# Display key statistics if found
if len(all_numerical_findings) > 0:
    print("\n=== KEY STATISTICS IDENTIFIED ===")
    
    # Education percentages by gender
    education_percentages = []
    years_of_education = []
    
    for finding in all_numerical_findings:
        if finding['type'] == 'education_percentage':
            education_percentages.append(finding)
        elif finding['type'] == 'years_of_education':
            years_of_education.append(finding)
    
    if len(education_percentages) > 0:
        print("Education percentages by gender:")
        for stat in education_percentages:
            stat_context_preview = stat['context'][:150] + '...' if len(stat['context']) > 150 else stat['context']
            print(f"  - {stat['value']}% | Context: {stat_context_preview}")
    
    if len(years_of_education) > 0:
        print("Years of education by gender:")
        for stat in years_of_education:
            stat_context_preview = stat['context'][:150] + '...' if len(stat['context']) > 150 else stat['context']
            print(f"  - {stat['value']} years | Context: {stat_context_preview}")

if len(all_bulgarian_census_data) > 0:
    print("\n=== BULGARIAN CENSUS REFERENCES ===")
    max_display = min(3, len(all_bulgarian_census_data))
    for i in range(max_display):
        data_item = all_bulgarian_census_data[i]
        display_number = i + 1
        context_preview = data_item['context'][:200] + '...' if len(data_item['context']) > 200 else data_item['context']
        print(f"{display_number}. Numbers: {data_item['numbers_found']} | Context: {context_preview}")

print("\n=== EXTRACTION COMPLETE ===")
print("Bulgarian 2011 census tertiary education by gender analysis completed.")
print("\nSUMMARY OF FINDINGS:")
print(f"- Tertiary education references: {tertiary_education_count}")
print(f"- Gender statistics: {gender_statistics_count}")
print(f"- 2011 census references: {census_2011_count}")
print(f"- Years of education data: {years_education_count}")
print(f"- Education percentages: {education_percentage_count}")
```