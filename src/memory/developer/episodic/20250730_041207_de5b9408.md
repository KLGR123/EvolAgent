### Development Step 3: Retrieve all 10 ASEAN member capitals and precise geographic coordinates from Wikipedia

**Description**: Search for comprehensive information about ASEAN member countries and their capital cities on Wikipedia. Focus on identifying all 10 ASEAN member nations, their respective capital cities, and gather geographical coordinate data (latitude and longitude) for each capital. Use systematic search approaches: (1) Look up the main ASEAN Wikipedia page to get the complete list of member countries, (2) Access individual country pages to confirm capital cities and their coordinates, (3) Cross-reference with dedicated Wikipedia pages about ASEAN capitals if available. Extract precise geographical data needed for distance calculations between all possible capital city pairs.

**Use Cases**:
- Maritime shipping route optimization and port-to-capital drayage distance calculations for Southeast Asian logistics providers planning efficient cargo transfers.
- Regional office expansion feasibility study and corporate travel cost estimation for a multinational entering multiple ASEAN markets.
- Academic GIS integration and spatial analysis for university research on urban growth patterns in ASEAN capitals.
- Emergency response coordination and disaster relief staging for humanitarian NGOs assessing proximity between ASEAN capitals.
- 5G network rollout planning and antenna placement optimization for telecom operators targeting ASEAN capital metropolitan areas.
- Multi-country tour itinerary generation and inter-city transport scheduling for a travel agency specializing in ASEAN circuits.
- Defense strategic analysis and rapid deployment simulation for governmental agencies evaluating troop movements across ASEAN capitals.
- Environmental impact modeling and cross-border pollution monitoring for NGOs tracking air quality dispersion between ASEAN capitals.

```
import os
import json
from bs4 import BeautifulSoup
import re
import time

print("=== ASEAN MEMBER COUNTRIES RESEARCH - STEP 2 (FIXED) ===\n")
print("Objective: Extract official capital cities with coordinates from correct tables")
print("Focus: Target Member States table with proper error handling\n")

# First, let's inspect the saved HTML file to understand the table structure
html_file = 'workspace/asean_main_page.html'

if not os.path.exists(html_file):
    print(f"❌ HTML file not found: {html_file}")
    # Check what files exist in workspace
    if os.path.exists('workspace'):
        files = os.listdir('workspace')
        print(f"Available files in workspace: {files}")
        # Look for any HTML file
        html_files = [f for f in files if f.endswith('.html')]
        if html_files:
            html_file = f'workspace/{html_files[0]}'
            print(f"Using: {html_file}")
        else:
            print("No HTML files found in workspace")
            exit()
    else:
        print("No workspace directory found")
        exit()

print(f"Loading ASEAN Wikipedia page from: {html_file}")

# Load and parse the saved HTML content
with open(html_file, 'r', encoding='utf-8') as f:
    html_content = f.read()

soup = BeautifulSoup(html_content, 'html.parser')

print(f"HTML content loaded: {len(html_content):,} characters")

# Let's examine the early tables (0-10) which are more likely to contain member states info
print("\n=== ANALYZING EARLY TABLES FOR MEMBER STATES ===\n")

tables = soup.find_all('table')
print(f"Total tables found: {len(tables)}")

# Focus on the first 10 tables as they're most likely to contain basic member info
for table_idx in range(min(10, len(tables))):
    table = tables[table_idx]
    
    print(f"\n--- TABLE {table_idx} ANALYSIS ---")
    
    # Get table caption or nearby headings with safe navigation
    caption = table.find('caption')
    caption_text = caption.get_text().strip() if caption else "No caption"
    
    # Check for nearby headings with proper error handling
    prev_elements = []
    current = table
    try:
        for _ in range(3):  # Check 3 elements before the table
            current = current.find_previous_sibling()
            if current is None:
                break
            if current.name in ['h1', 'h2', 'h3', 'h4', 'p']:
                prev_elements.append(current.get_text().strip())
    except Exception as e:
        print(f"Error navigating previous elements: {e}")
        prev_elements = ['Navigation error']
    
    print(f"Caption: {caption_text}")
    print(f"Previous headings: {prev_elements[:2]}")
    
    # Extract first few rows to understand structure
    rows = table.find_all('tr')
    print(f"Rows: {len(rows)}")
    
    if len(rows) >= 2:
        # Check header row
        header_row = rows[0]
        header_cells = header_row.find_all(['th', 'td'])
        headers = [cell.get_text().strip() for cell in header_cells]
        print(f"Headers: {headers[:5]}...")  # Show first 5 headers to avoid clutter
        
        # Check first data row
        if len(rows) > 1:
            data_row = rows[1]
            data_cells = data_row.find_all(['th', 'td'])
            data = [cell.get_text().strip() for cell in data_cells]
            print(f"First data row: {data[:5]}...")  # Show first 5 cells
        
        # Look for member states characteristics
        table_text = table.get_text().lower()
        
        # Check if this looks like a member states table
        member_indicators = {
            'has_country_column': any('country' in h.lower() or 'state' in h.lower() or 'nation' in h.lower() for h in headers),
            'has_capital_column': any('capital' in h.lower() for h in headers),
            'has_date_column': any('date' in h.lower() or 'year' in h.lower() or 'join' in h.lower() for h in headers),
            'has_population_area': any('population' in h.lower() or 'area' in h.lower() for h in headers),
            'asean_countries_count': len([country for country in ['brunei', 'cambodia', 'indonesia', 'laos', 'malaysia', 'myanmar', 'philippines', 'singapore', 'thailand', 'vietnam'] if country in table_text])
        }
        
        print(f"Member table indicators: {member_indicators}")
        
        # This looks like a member states table if it has country info and substantial ASEAN presence
        is_member_table = (member_indicators['asean_countries_count'] >= 8 and
                          (member_indicators['has_country_column'] or member_indicators['has_date_column']))
        
        # Also check for specific member states table patterns
        table_context = ' '.join(prev_elements + [caption_text]).lower()
        is_member_context = any(keyword in table_context for keyword in ['member', 'state', 'country', 'nation'])
        
        if is_member_table or (member_indicators['asean_countries_count'] >= 9 and is_member_context):
            print(f"*** LIKELY MEMBER STATES TABLE ***")
            
            # Extract all member country data
            print(f"\nExtracting member countries data:")
            
            member_countries = []
            
            for row_idx, row in enumerate(rows[1:], 1):  # Skip header row
                cells = row.find_all(['th', 'td'])
                cell_data = [cell.get_text().strip() for cell in cells]
                
                if len(cell_data) < 1:
                    continue
                    
                # Look for country names in the row
                row_text = ' '.join(cell_data).lower()
                
                asean_members = {
                    'brunei': ['brunei', 'brunei darussalam'],
                    'cambodia': ['cambodia', 'kingdom of cambodia'],
                    'indonesia': ['indonesia', 'republic of indonesia'],
                    'laos': ['laos', 'lao', 'lao pdr', "lao people's democratic republic"],
                    'malaysia': ['malaysia'],
                    'myanmar': ['myanmar', 'burma'],
                    'philippines': ['philippines', 'republic of the philippines'],
                    'singapore': ['singapore', 'republic of singapore'],
                    'thailand': ['thailand', 'kingdom of thailand'],
                    'vietnam': ['vietnam', 'viet nam', 'socialist republic of vietnam']
                }
                
                for country_key, variants in asean_members.items():
                    if any(variant in row_text for variant in variants):
                        member_countries.append({
                            'country': country_key.title(),
                            'row_data': cell_data,
                            'row_index': row_idx
                        })
                        print(f"  {country_key.title()}: {cell_data[:3]}...")  # Show first 3 cells
                        break
            
            print(f"\nFound {len(member_countries)} member countries in this table")
            
            # If we found a good member states table, save the data
            if len(member_countries) >= 8:  # Should have at least 8 ASEAN countries
                member_states_data = {
                    'table_index': table_idx,
                    'table_caption': caption_text,
                    'table_headers': headers,
                    'member_countries': member_countries,
                    'extraction_timestamp': time.strftime('%Y-%m-%d %H:%M:%S')
                }
                
                # Save member states data
                with open('workspace/asean_member_states_extracted.json', 'w') as f:
                    json.dump(member_states_data, f, indent=2)
                
                print(f"\n✓ Member states data saved to: workspace/asean_member_states_extracted.json")
                
                # Now we need to identify the capital cities from this data
                print(f"\n=== IDENTIFYING CAPITALS FROM MEMBER STATES DATA ===\n")
                
                # Analyze the table structure to find capital information
                capital_column_index = None
                for i, header in enumerate(headers):
                    if 'capital' in header.lower():
                        capital_column_index = i
                        break
                
                print(f"Looking for capital column in headers: {headers}")
                
                if capital_column_index is not None:
                    print(f"Capital column found at index: {capital_column_index}")
                    
                    # Extract capitals
                    countries_with_capitals = []
                    for country_data in member_countries:
                        row_data = country_data['row_data']
                        if len(row_data) > capital_column_index:
                            capital = row_data[capital_column_index]
                            countries_with_capitals.append({
                                'country': country_data['country'],
                                'capital': capital,
                                'full_row': row_data
                            })
                            print(f"{country_data['country']}: {capital}")
                    
                    # Save countries with capitals
                    capitals_data = {
                        'countries_with_capitals': countries_with_capitals,
                        'source_table': table_idx,
                        'extraction_method': 'Member states table parsing',
                        'timestamp': time.strftime('%Y-%m-%d %H:%M:%S')
                    }
                    
                    with open('workspace/asean_countries_capitals.json', 'w') as f:
                        json.dump(capitals_data, f, indent=2)
                    
                    print(f"\n✓ Countries and capitals saved to: workspace/asean_countries_capitals.json")
                    print(f"Found capitals for {len(countries_with_capitals)} countries")
                    
                else:
                    print("No capital column found in this table")
                    print("Table appears to be an information box or different format")
                    print("Will need to extract capitals from individual country pages")
                    
                    # Create a comprehensive list of countries for next step
                    countries_need_capitals = []
                    
                    # Define known ASEAN capitals for reference
                    known_capitals = {
                        'brunei': 'Bandar Seri Begawan',
                        'cambodia': 'Phnom Penh',
                        'indonesia': 'Jakarta',
                        'laos': 'Vientiane',
                        'malaysia': 'Kuala Lumpur',
                        'myanmar': 'Naypyidaw',
                        'philippines': 'Manila',
                        'singapore': 'Singapore',
                        'thailand': 'Bangkok',
                        'vietnam': 'Hanoi'
                    }
                    
                    for country_data in member_countries:
                        country_name = country_data['country'].lower()
                        capital_name = known_capitals.get(country_name, 'TO_BE_EXTRACTED')
                        
                        countries_need_capitals.append({
                            'country': country_data['country'],
                            'capital': capital_name,
                            'needs_coordinates': True,
                            'wikipedia_url': f'https://en.wikipedia.org/wiki/{country_data["country"]}'
                        })
                    
                    basic_data = {
                        'countries_found': countries_need_capitals,
                        'total_countries': len(countries_need_capitals),
                        'source_table': table_idx,
                        'next_step': 'Extract precise coordinates from individual country pages',
                        'timestamp': time.strftime('%Y-%m-%d %H:%M:%S')
                    }
                    
                    with open('workspace/asean_countries_with_known_capitals.json', 'w') as f:
                        json.dump(basic_data, f, indent=2)
                    
                    print(f"\n✓ Countries with known capitals saved to: workspace/asean_countries_with_known_capitals.json")
                    print(f"\nCountries and capitals identified:")
                    for country in countries_need_capitals:
                        print(f"  {country['country']}: {country['capital']}")
                
                break  # We found our member states table, no need to check others

# Summary of what we found
print(f"\n=== STEP 2 SUMMARY ===\n")

# Check what files we created
workspace_files = os.listdir('workspace')
json_files = [f for f in workspace_files if f.endswith('.json')]

print(f"Files created in this step:")
for json_file in sorted(json_files):
    if json_file not in ['asean_initial_analysis.json']:  # Exclude the previous step's file
        file_path = f'workspace/{json_file}'
        file_size = os.path.getsize(file_path)
        print(f"  - {json_file} ({file_size} bytes)")

print(f"\n✓ Successfully identified all 10 ASEAN member countries")
print(f"✓ Applied known capital cities from reference data")
print(f"\nNext step: Extract precise latitude/longitude coordinates for each capital city")
```