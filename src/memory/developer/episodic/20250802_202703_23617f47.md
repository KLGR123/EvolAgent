### Development Step 22: 2011 Bulgarian Census: Tertiary Education Completion by Gender (Official NSI Data)

**Description**: Search for the 2011 Bulgarian census data on tertiary education completion by gender. Look for official census results from Bulgaria's National Statistical Institute or other authoritative sources that provide the specific breakdown of men and women who completed tertiary education in 2011.

**Use Cases**:
- Government education policy assessment and funding allocation in Bulgaria using 2011 tertiary completion by gender data
- Academic research on gender disparities in higher education enrollment for a peer-reviewed sociology study
- NGO program design for female STEM empowerment initiatives based on regional tertiary attainment statistics
- Data journalism dashboard that visualizes Bulgarian gender gaps in university graduation rates
- Corporate workforce planning for a Balkan expansion project assessing skilled graduate availability by gender
- Automated ETL pipeline ingesting official census education metrics into a national data warehouse
- Civic tech platform building interactive maps of local tertiary completion rates by gender for public transparency
- International development monitoring of UN SDG progress on gender equality in education using census breakdowns

```
import os
import json
from bs4 import BeautifulSoup
import re
import time

print("=== BULGARIAN 2011 CENSUS TERTIARY EDUCATION BY GENDER - ROBUST EXTRACTION ===")
print("Strategy: Simple, robust analysis avoiding all scoping issues\n")

# Check workspace
workspace_path = 'workspace'
if not os.path.exists(workspace_path):
    print("No workspace directory found")
    exit()

# Get all files and categorize them
all_files = os.listdir(workspace_path)
print(f"Total files in workspace: {len(all_files)}")

# Find HTML files manually
html_files_list = []
for filename in all_files:
    if filename.endswith('.html'):
        html_files_list.append(filename)

print(f"HTML files found: {len(html_files_list)}")

# Look specifically for Bulgarian Demographics files
bulgarian_demographics_files = []
for filename in html_files_list:
    if 'Demographics_of_Bulgaria' in filename:
        bulgarian_demographics_files.append(filename)
        print(f"  Found Bulgarian Demographics file: {filename}")

if not bulgarian_demographics_files:
    print("No Bulgarian Demographics files found")
    exit()

# Analyze the first Bulgarian Demographics file
target_file = bulgarian_demographics_files[0]
print(f"\n=== ANALYZING: {target_file} ===")

filepath = os.path.join(workspace_path, target_file)
with open(filepath, 'r', encoding='utf-8') as f:
    html_content = f.read()

print(f"File size: {len(html_content):,} characters")

# Parse HTML
soup = BeautifulSoup(html_content, 'html.parser')
page_title = soup.find('title')
if page_title:
    print(f"Page title: {page_title.get_text().strip()}")

# Extract all text
all_text = soup.get_text()
print(f"Text content: {len(all_text):,} characters")

# Search for tertiary education data with gender breakdown
print("\n=== SEARCHING FOR TERTIARY EDUCATION DATA ===")

# Look for education sections
education_matches = []

# Pattern 1: Look for "tertiary education" followed by gender data
pattern1 = r'tertiary education[^.]{0,500}(?:male|female|men|women)[^.]{0,200}'
matches1 = re.finditer(pattern1, all_text, re.IGNORECASE | re.DOTALL)
for match in matches1:
    context_start = max(0, match.start() - 200)
    context_end = min(len(all_text), match.end() + 200)
    context = all_text[context_start:context_end]
    education_matches.append({
        'type': 'tertiary_education_with_gender',
        'match_text': match.group(),
        'context': context
    })

print(f"Tertiary education with gender matches: {len(education_matches)}")

# Pattern 2: Look for education statistics with percentages and gender
pattern2 = r'(?:male|female|men|women)[^.]{0,100}(?:education|tertiary|university)[^.]{0,100}(\d+\.?\d*\s*%?)'
matches2 = re.finditer(pattern2, all_text, re.IGNORECASE)
for match in matches2:
    context_start = max(0, match.start() - 200)
    context_end = min(len(all_text), match.end() + 200)
    context = all_text[context_start:context_end]
    education_matches.append({
        'type': 'gender_education_statistics',
        'match_text': match.group(),
        'percentage': match.group(1) if match.groups() else 'No percentage',
        'context': context
    })

print(f"Gender education statistics matches: {len(education_matches)}")

# Pattern 3: Look for 2011 census data with education
pattern3 = r'2011[^.]{0,300}(?:education|tertiary|university)[^.]{0,200}(?:male|female|men|women)[^.]{0,100}'
matches3 = re.finditer(pattern3, all_text, re.IGNORECASE | re.DOTALL)
for match in matches3:
    context_start = max(0, match.start() - 200)
    context_end = min(len(all_text), match.end() + 200)
    context = all_text[context_start:context_end]
    education_matches.append({
        'type': '2011_census_education',
        'match_text': match.group(),
        'context': context
    })

print(f"2011 census education matches: {len(education_matches)}")

# Display all matches found
if education_matches:
    print("\n=== EDUCATION MATCHES FOUND ===")
    for i, match in enumerate(education_matches, 1):
        print(f"\nMatch {i} ({match['type']}):")
        print(f"  Text: {match['match_text'][:200]}...")
        if 'percentage' in match:
            print(f"  Percentage: {match['percentage']}")
        print(f"  Context: {match['context'][:300]}...")
        print()

# Look for specific numerical data in education context
print("\n=== EXTRACTING NUMERICAL DATA ===")

numerical_findings = []

# Search for years of education by gender
years_pattern = r'(?:male|female|men|women)[^.]{0,50}(\d+)\s*years?[^.]{0,50}(?:education|tertiary)'
years_matches = re.finditer(years_pattern, all_text, re.IGNORECASE)
for match in years_matches:
    context_start = max(0, match.start() - 150)
    context_end = min(len(all_text), match.end() + 150)
    context = all_text[context_start:context_end]
    numerical_findings.append({
        'type': 'years_of_education',
        'value': match.group(1),
        'context': context
    })

# Search for percentage data with gender
percentage_pattern = r'(?:male|female|men|women)[^.]{0,100}(\d+\.?\d*)\s*%'
percentage_matches = re.finditer(percentage_pattern, all_text, re.IGNORECASE)
for match in percentage_matches:
    context_start = max(0, match.start() - 150)
    context_end = min(len(all_text), match.end() + 150)
    context = all_text[context_start:context_end]
    # Check if context mentions education
    if any(term in context.lower() for term in ['education', 'tertiary', 'university', 'degree']):
        numerical_findings.append({
            'type': 'education_percentage',
            'value': match.group(1),
            'context': context
        })

print(f"Numerical findings: {len(numerical_findings)}")

for i, finding in enumerate(numerical_findings, 1):
    print(f"\nFinding {i} ({finding['type']}):")
    print(f"  Value: {finding['value']}")
    print(f"  Context: {finding['context'][:250]}...")

# Look for specific Bulgarian census data
print("\n=== SEARCHING FOR BULGARIAN CENSUS DATA ===")

bulgarian_census_data = []

# Search for Bulgaria + 2011 + education combinations
bulgaria_2011_pattern = r'(?:bulgaria|bulgarian)[^.]{0,200}2011[^.]{0,200}(?:education|tertiary|university)[^.]{0,200}'
bulgaria_matches = re.finditer(bulgaria_2011_pattern, all_text, re.IGNORECASE | re.DOTALL)
for match in bulgaria_matches:
    context_start = max(0, match.start() - 300)
    context_end = min(len(all_text), match.end() + 300)
    context = all_text[context_start:context_end]
    
    # Extract any numbers from this context
    numbers = re.findall(r'\d+\.?\d*\s*%?', context)
    
    bulgarian_census_data.append({
        'match_text': match.group(),
        'context': context,
        'numbers_found': numbers
    })

print(f"Bulgarian census data matches: {len(bulgarian_census_data)}")

for i, data in enumerate(bulgarian_census_data, 1):
    print(f"\nBulgarian Census Data {i}:")
    print(f"  Match: {data['match_text'][:150]}...")
    print(f"  Numbers found: {data['numbers_found']}")
    print(f"  Context: {data['context'][:300]}...")

# Save comprehensive results
results = {
    'objective': 'Bulgarian 2011 census tertiary education completion by gender',
    'analysis_timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
    'file_analyzed': target_file,
    'education_matches_found': len(education_matches),
    'numerical_findings_found': len(numerical_findings),
    'bulgarian_census_matches': len(bulgarian_census_data),
    'detailed_results': {
        'education_matches': education_matches,
        'numerical_findings': numerical_findings,
        'bulgarian_census_data': bulgarian_census_data
    },
    'summary': {
        'tertiary_education_references': len([m for m in education_matches if m['type'] == 'tertiary_education_with_gender']),
        'gender_statistics': len([m for m in education_matches if m['type'] == 'gender_education_statistics']),
        'census_2011_references': len([m for m in education_matches if m['type'] == '2011_census_education']),
        'years_of_education_data': len([f for f in numerical_findings if f['type'] == 'years_of_education']),
        'education_percentages': len([f for f in numerical_findings if f['type'] == 'education_percentage'])
    }
}

results_file = os.path.join(workspace_path, 'bulgarian_census_final_results.json')
with open(results_file, 'w', encoding='utf-8') as f:
    json.dump(results, f, indent=2, ensure_ascii=False)

print(f"\n=== FINAL SUMMARY ===")
print(f"Results saved to: {results_file}")
print(f"Education matches found: {results['education_matches_found']}")
print(f"Numerical findings: {results['numerical_findings_found']}")
print(f"Bulgarian census matches: {results['bulgarian_census_matches']}")

# Display key statistics if found
if numerical_findings:
    print("\n=== KEY STATISTICS IDENTIFIED ===")
    education_stats = [f for f in numerical_findings if f['type'] == 'education_percentage']
    years_stats = [f for f in numerical_findings if f['type'] == 'years_of_education']
    
    if education_stats:
        print("Education percentages by gender:")
        for stat in education_stats:
            print(f"  - {stat['value']}% | Context: {stat['context'][:150]}...")
    
    if years_stats:
        print("Years of education by gender:")
        for stat in years_stats:
            print(f"  - {stat['value']} years | Context: {stat['context'][:150]}...")

if bulgarian_census_data:
    print("\n=== BULGARIAN CENSUS REFERENCES ===")
    for i, data in enumerate(bulgarian_census_data[:3], 1):
        print(f"{i}. Numbers: {data['numbers_found']} | Context: {data['context'][:200]}...")

print("\n=== EXTRACTION COMPLETE ===")
print("Bulgarian 2011 census tertiary education by gender analysis completed.")
```