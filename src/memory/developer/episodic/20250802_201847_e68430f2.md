### Development Step 3: Search 2011 Bulgarian Census Data on Tertiary Education Completion by Gender

**Description**: Search for the 2011 Bulgarian census data on tertiary education completion by gender. Look for official census results from Bulgaria's National Statistical Institute or other authoritative sources that provide the specific breakdown of men and women who completed tertiary education in 2011.

**Use Cases**:
- Government policy analysis to quantify male and female tertiary education attainment in Bulgaria’s 2011 census, guiding resource allocation for gender equity programs
- Academic research on historical gender gaps in higher education across EU member states, using Bulgarian 2011 census data for comparative studies
- Non-profit program planning to identify regions with low female university completion rates in Bulgaria and design targeted scholarship initiatives
- Data journalism projects building interactive maps and charts that illustrate 2011 Bulgarian tertiary education by gender for public awareness articles
- Market research for multinational corporations assessing the availability of skilled graduates by gender in Bulgarian labor markets before site selection
- Public health research correlating regional education levels by gender from the 2011 census with health outcomes to shape community outreach campaigns
- Educational consulting for international universities to tailor exchange programs based on gender distribution of Bulgarian tertiary-educated graduates

```
import os
import requests
from bs4 import BeautifulSoup
import json
import time
import re

# Create workspace directory if it doesn't exist
if not os.path.exists('workspace'):
    os.makedirs('workspace')

print("=== BULGARIAN 2011 CENSUS: FIXED ALTERNATIVE SEARCH ===")
print("Objective: Find tertiary education by gender data using alternative sources")
print("Previous attempt failed due to variable definition bug - now fixed\n")

# Alternative search strategy: Use multiple approaches to find the data
headers = {
    'User-Agent': 'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36'
}

# Try alternative sources for Bulgarian census data
alternative_sources = [
    "https://en.wikipedia.org/wiki/Education_in_Bulgaria",
    "https://en.wikipedia.org/wiki/Demographics_of_Bulgaria", 
    "https://en.wikipedia.org/wiki/Bulgaria",
    "https://ec.europa.eu/eurostat",  # EU statistical office
    "https://data.worldbank.org"      # World Bank data
]

print("Step 1: Trying alternative data sources...\n")

successful_sources = []
failed_sources = []

for url in alternative_sources:
    print(f"Accessing: {url}")
    try:
        response = requests.get(url, headers=headers, timeout=15)
        print(f"Status: {response.status_code}")
        
        if response.status_code == 200:
            print(f"✓ Successfully accessed {url}")
            
            # Save content
            filename = url.replace('https://', '').replace('http://', '').replace('/', '_').replace('.', '_') + '.html'
            filepath = f'workspace/{filename}'
            
            with open(filepath, 'w', encoding='utf-8') as f:
                f.write(response.text)
            
            # Analyze content for Bulgarian census and education data
            soup = BeautifulSoup(response.content, 'html.parser')
            title = soup.find('title')
            title_text = title.get_text().strip() if title else 'No title found'
            
            # FIX: Define content_text properly
            content_text = soup.get_text().lower()
            
            # Look for specific Bulgarian census and education indicators
            bulgaria_indicators = ['bulgaria', 'bulgarian']
            census_indicators = ['2011', 'census', 'population']
            education_indicators = ['tertiary', 'education', 'university', 'higher education', 'degree']
            gender_indicators = ['gender', 'men', 'women', 'male', 'female']
            
            has_bulgaria = any(indicator in content_text for indicator in bulgaria_indicators)
            has_census = any(indicator in content_text for indicator in census_indicators)
            has_education = any(indicator in content_text for indicator in education_indicators)
            has_gender = any(indicator in content_text for indicator in gender_indicators)
            
            relevance_score = sum([has_bulgaria, has_census, has_education, has_gender])
            
            successful_sources.append({
                'url': url,
                'title': title_text,
                'filename': filepath,
                'has_bulgaria': has_bulgaria,
                'has_census': has_census,
                'has_education': has_education,
                'has_gender': has_gender,
                'relevance_score': relevance_score,
                'content_length': len(response.text)
            })
            
            print(f"  Title: {title_text}")
            print(f"  Bulgaria content: {has_bulgaria}")
            print(f"  Census content: {has_census}")
            print(f"  Education content: {has_education}")
            print(f"  Gender content: {has_gender}")
            print(f"  Relevance score: {relevance_score}/4")
            
        else:
            failed_sources.append({'url': url, 'status': response.status_code})
            print(f"✗ Failed - Status: {response.status_code}")
            
    except Exception as e:
        failed_sources.append({'url': url, 'error': str(e)})
        print(f"✗ Error: {str(e)}")
    
    print()
    time.sleep(1)  # Brief pause between requests

print(f"=== ALTERNATIVE SEARCH RESULTS ===\n")
print(f"Successfully accessed: {len(successful_sources)} sources")
print(f"Failed to access: {len(failed_sources)} sources\n")

# Sort sources by relevance score
successful_sources.sort(key=lambda x: x['relevance_score'], reverse=True)

# Analyze the most relevant sources
if successful_sources:
    print("--- Top Sources by Relevance ---\n")
    
    for i, source in enumerate(successful_sources, 1):
        print(f"{i}. {source['url']} (Score: {source['relevance_score']}/4)")
        print(f"   Title: {source['title']}")
        print(f"   File: {source['filename']}")
        
        if source['relevance_score'] >= 2:  # Analyze sources with decent relevance
            print(f"   *** ANALYZING THIS SOURCE ***")
            
            with open(source['filename'], 'r', encoding='utf-8') as f:
                html_content = f.read()
            
            soup = BeautifulSoup(html_content, 'html.parser')
            
            # Look for tables with statistical data
            tables = soup.find_all('table')
            print(f"   Found {len(tables)} tables")
            
            # Search for specific Bulgarian education statistics
            text_content = soup.get_text()
            
            # Look for sentences mentioning Bulgaria, education, and gender/statistics
            sentences = text_content.split('.')
            relevant_sentences = []
            
            for sentence in sentences:
                sentence_lower = sentence.lower().strip()
                if len(sentence_lower) > 20:  # Skip very short sentences
                    has_bulgaria = 'bulgaria' in sentence_lower
                    has_education_terms = any(term in sentence_lower for term in ['tertiary', 'education', 'university', 'higher', 'degree'])
                    has_numbers = bool(re.search(r'\d+', sentence_lower))
                    has_2011 = '2011' in sentence_lower
                    
                    if has_bulgaria and (has_education_terms or has_2011) and has_numbers:
                        relevant_sentences.append(sentence.strip())
            
            print(f"   Found {len(relevant_sentences)} potentially relevant sentences")
            
            # Look for specific numerical patterns that might be education statistics
            education_numbers = []
            
            # Context search around numbers
            for match in re.finditer(r'\d+[,.]?\d*\s*%?', text_content):
                start = max(0, match.start() - 100)
                end = min(len(text_content), match.end() + 100)
                context = text_content[start:end].lower()
                
                if 'bulgaria' in context and any(term in context for term in ['education', 'tertiary', 'university']):
                    education_numbers.append({
                        'number': match.group(),
                        'context': text_content[start:end].strip()
                    })
            
            print(f"   Found {len(education_numbers)} numbers in educational context")
            
            # Look specifically for tables that might contain census or education data
            relevant_tables = []
            for table_idx, table in enumerate(tables):
                table_text = table.get_text().lower()
                if any(term in table_text for term in ['education', 'tertiary', 'university', 'census', '2011']):
                    # Extract table headers and sample data
                    headers = [th.get_text().strip() for th in table.find_all('th')]
                    rows = table.find_all('tr')
                    sample_rows = []
                    for row in rows[1:4]:  # Get first 3 data rows
                        cells = [td.get_text().strip() for td in row.find_all(['td', 'th'])]
                        if cells:
                            sample_rows.append(cells)
                    
                    relevant_tables.append({
                        'table_index': table_idx,
                        'headers': headers,
                        'sample_rows': sample_rows,
                        'total_rows': len(rows)
                    })
            
            print(f"   Found {len(relevant_tables)} relevant tables")
            
            # Save detailed analysis
            detailed_analysis = {
                'source_url': source['url'],
                'relevance_score': source['relevance_score'],
                'tables_count': len(tables),
                'relevant_tables': relevant_tables,
                'relevant_sentences': relevant_sentences[:10],  # Top 10 sentences
                'education_numbers': education_numbers[:5],     # Top 5 number contexts
                'content_sample': text_content[:3000]           # First 3000 characters
            }
            
            analysis_file = f'workspace/detailed_analysis_{i}.json'
            with open(analysis_file, 'w', encoding='utf-8') as f:
                json.dump(detailed_analysis, f, indent=2, ensure_ascii=False)
            
            print(f"   Detailed analysis saved to: {analysis_file}")
            
            # Show some key findings
            if relevant_sentences:
                print(f"   Sample relevant sentence: {relevant_sentences[0][:150]}...")
            
            if education_numbers:
                print(f"   Sample education number: {education_numbers[0]['number']} - Context: {education_numbers[0]['context'][:100]}...")
            
            if relevant_tables:
                print(f"   Sample table headers: {relevant_tables[0]['headers'][:5]}")
        
        print()

# Try to search for specific Bulgarian census statistics in the content
print("=== SEARCHING FOR SPECIFIC CENSUS DATA ===\n")

specific_findings = []

for source in successful_sources:
    if source['relevance_score'] >= 2:
        print(f"Deep search in: {source['url']}")
        
        with open(source['filename'], 'r', encoding='utf-8') as f:
            html_content = f.read()
        
        # Search for specific patterns that might indicate tertiary education statistics
        patterns_to_search = [
            r'tertiary education.*?\d+[,.]?\d*\s*%',
            r'university.*?\d+[,.]?\d*\s*%',
            r'higher education.*?\d+[,.]?\d*\s*%',
            r'2011.*?census.*?education',
            r'education.*?2011.*?census',
            r'men.*?women.*?education',
            r'male.*?female.*?tertiary',
            r'gender.*?education.*?\d+'
        ]
        
        for pattern in patterns_to_search:
            matches = re.finditer(pattern, html_content, re.IGNORECASE | re.DOTALL)
            for match in matches:
                start = max(0, match.start() - 200)
                end = min(len(html_content), match.end() + 200)
                context = html_content[start:end].strip()
                
                specific_findings.append({
                    'source': source['url'],
                    'pattern': pattern,
                    'match': match.group(),
                    'context': context
                })
        
        print(f"  Found {len([f for f in specific_findings if f['source'] == source['url']])} specific pattern matches")

print(f"\nTotal specific findings: {len(specific_findings)}")

if specific_findings:
    print("\n--- Specific Census/Education Findings ---")
    for i, finding in enumerate(specific_findings[:5], 1):  # Show top 5
        print(f"{i}. Pattern: {finding['pattern']}")
        print(f"   Match: {finding['match']}")
        print(f"   Source: {finding['source']}")
        print(f"   Context: {finding['context'][:200]}...")
        print()

# Save comprehensive search results
search_results = {
    'search_objective': 'Bulgarian 2011 census tertiary education by gender',
    'search_timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
    'approach': 'Fixed alternative sources search',
    'sources_accessed': len(successful_sources),
    'sources_failed': len(failed_sources),
    'relevant_sources': len([s for s in successful_sources if s['relevance_score'] >= 2]),
    'specific_findings': len(specific_findings),
    'successful_sources': successful_sources,
    'failed_sources': failed_sources,
    'census_education_findings': specific_findings
}

with open('workspace/bulgarian_census_fixed_search.json', 'w', encoding='utf-8') as f:
    json.dump(search_results, f, indent=2, ensure_ascii=False)

print(f"=== FIXED SEARCH COMPLETE ===\n")
print(f"Search results saved to: workspace/bulgarian_census_fixed_search.json")
print(f"Sources successfully accessed: {len(successful_sources)}")
print(f"Highly relevant sources: {len([s for s in successful_sources if s['relevance_score'] >= 3])}")
print(f"Specific census/education findings: {len(specific_findings)}")
print(f"\nNext steps: Analyze specific findings for tertiary education gender statistics")
```