### Development Step 21: Retrieve 2011 Bulgarian Census Data on Tertiary Education Completion by Gender

**Description**: Search for the 2011 Bulgarian census data on tertiary education completion by gender. Look for official census results from Bulgaria's National Statistical Institute or other authoritative sources that provide the specific breakdown of men and women who completed tertiary education in 2011.

**Use Cases**:
- Government gender equity policy development using the extraction pipeline to analyze male and female tertiary completion rates across Bulgarian municipalities, driving targeted funding and program design for underrepresented groups
- Academic comparative research aggregating 2011 Bulgarian census tertiary education data by gender alongside other nations’ datasets to study cross‐national trends in higher education gender gaps
- NGO scholarship targeting to identify districts with the lowest female tertiary graduation rates, optimizing scholarship distribution and measuring impact of educational assistance programs
- Market entry analysis for EdTech firms assessing regional gender splits in higher education attainment in Bulgaria to tailor product offerings and marketing strategies for male and female student segments
- Data journalism projects that integrate extracted 2011 census statistics on tertiary education by gender into interactive visualizations and infographics, highlighting historical education trends for public audiences
- Public health resource allocation correlating regional tertiary education completion rates by gender with health outcome metrics, informing targeted community health education campaigns
- Automated statistical reporting workflows that schedule regular runs of the scraping and extraction code against the National Statistical Institute site, automatically updating internal BI dashboards with the latest census tables

```
import os
import json
from bs4 import BeautifulSoup
import re

print("=== BULGARIAN 2011 CENSUS TERTIARY EDUCATION BY GENDER - DETAILED EXTRACTION ===")
print("Strategy: Extract specific numerical data from existing matches\n")

# Check workspace and examine the latest results
workspace_path = 'workspace'
if not os.path.exists(workspace_path):
    print("No workspace directory found")
    exit()

# First, let's inspect the latest extraction results to understand what we found
latest_results_file = os.path.join(workspace_path, 'bulgarian_census_tertiary_education_final_extraction.json')

if os.path.exists(latest_results_file):
    print("Examining latest extraction results...")
    with open(latest_results_file, 'r', encoding='utf-8') as f:
        latest_results = json.load(f)
    
    print(f"Analysis timestamp: {latest_results.get('analysis_timestamp')}")
    print(f"Files analyzed: {latest_results.get('files_analyzed')}")
    print(f"Total matches found: {latest_results.get('total_matches_found')}")
    
    if latest_results.get('detailed_matches'):
        print(f"\nDetailed matches available: {len(latest_results['detailed_matches'])}")
        
        for i, match in enumerate(latest_results['detailed_matches'], 1):
            print(f"\nMatch {i}:")
            print(f"  File: {match['file']}")
            print(f"  Pattern: {match['pattern_number']}")
            print(f"  Match text: {match['match_text']}")
            print(f"  Has Bulgaria: {match['has_bulgaria']}")
            print(f"  Has 2011: {match['has_2011']}")
            print(f"  Context preview: {match['context'][:200]}...")
else:
    print("No latest extraction results found")

# Now let's examine the Demographics of Bulgaria file directly for more detailed analysis
demographics_file = None
for file in os.listdir(workspace_path):
    if 'Demographics_of_Bulgaria' in file and file.endswith('.html'):
        demographics_file = file
        break

if demographics_file:
    print(f"\n=== DETAILED ANALYSIS OF {demographics_file} ===")
    filepath = os.path.join(workspace_path, demographics_file)
    
    with open(filepath, 'r', encoding='utf-8') as f:
        html_content = f.read()
    
    soup = BeautifulSoup(html_content, 'html.parser')
    all_text = soup.get_text()
    
    print(f"Content length: {len(all_text):,} characters")
    
    # Look for education section specifically
    education_section_patterns = [
        r'Education\[edit\][^§]{0,2000}',
        r'Educational attainment[^§]{0,2000}',
        r'Tertiary education[^§]{0,2000}'
    ]
    
    education_sections = []
    for pattern in education_section_patterns:
        matches = re.finditer(pattern, all_text, re.IGNORECASE | re.DOTALL)
        for match in matches:
            education_sections.append(match.group())
    
    print(f"Education sections found: {len(education_sections)}")
    
    if education_sections:
        for i, section in enumerate(education_sections, 1):
            print(f"\n--- Education Section {i} ---")
            print(f"Length: {len(section)} characters")
            print(f"Preview: {section[:500]}...")
            
            # Look for specific statistics in this section
            stats_patterns = [
                r'(\d+\.?\d*)\s*%[^.]*(?:men|male)',
                r'(\d+\.?\d*)\s*%[^.]*(?:women|female)',
                r'(?:men|male)[^.]*?(\d+\.?\d*)\s*%',
                r'(?:women|female)[^.]*?(\d+\.?\d*)\s*%',
                r'tertiary[^.]*?(\d+\.?\d*)\s*%',
                r'higher education[^.]*?(\d+\.?\d*)\s*%'
            ]
            
            section_stats = []
            for pattern in stats_patterns:
                matches = re.finditer(pattern, section, re.IGNORECASE)
                for match in matches:
                    context_start = max(0, match.start() - 100)
                    context_end = min(len(section), match.end() + 100)
                    context = section[context_start:context_end]
                    section_stats.append({
                        'percentage': match.group(1),
                        'context': context,
                        'pattern': pattern
                    })
            
            if section_stats:
                print(f"\nStatistics found in section {i}:")
                for stat in section_stats:
                    print(f"  - {stat['percentage']}% | Context: {stat['context'][:150]}...")
    
    # Look for tables in the demographics page that might contain education data
    print(f"\n=== EXAMINING TABLES IN {demographics_file} ===")
    
    tables = soup.find_all('table')
    print(f"Total tables found: {len(tables)}")
    
    education_related_tables = []
    for i, table in enumerate(tables):
        table_text = table.get_text()
        table_lower = table_text.lower()
        
        # Check for education-related content
        education_keywords = ['education', 'tertiary', 'university', 'degree', 'literacy', 'school']
        gender_keywords = ['men', 'women', 'male', 'female', 'gender']
        
        has_education = any(keyword in table_lower for keyword in education_keywords)
        has_gender = any(keyword in table_lower for keyword in gender_keywords)
        has_numbers = bool(re.search(r'\d+', table_text))
        has_2011 = '2011' in table_lower
        
        if has_education and (has_gender or has_2011) and has_numbers:
            # Extract table details
            headers = [th.get_text().strip() for th in table.find_all('th')]
            rows = table.find_all('tr')
            
            sample_data = []
            for row in rows[:5]:  # First 5 rows
                cells = [cell.get_text().strip() for cell in row.find_all(['td', 'th'])]
                if cells:
                    sample_data.append(cells)
            
            education_related_tables.append({
                'table_index': i,
                'headers': headers,
                'sample_data': sample_data,
                'total_rows': len(rows),
                'has_education': has_education,
                'has_gender': has_gender,
                'has_2011': has_2011,
                'table_text_preview': table_text[:300]
            })
    
    print(f"Education-related tables found: {len(education_related_tables)}")
    
    for i, table_info in enumerate(education_related_tables, 1):
        print(f"\n--- Table {i} (Index {table_info['table_index']}) ---")
        print(f"Headers: {table_info['headers'][:8]}")
        print(f"Rows: {table_info['total_rows']}")
        print(f"Has education: {table_info['has_education']}")
        print(f"Has gender: {table_info['has_gender']}")
        print(f"Has 2011: {table_info['has_2011']}")
        print(f"Preview: {table_info['table_text_preview']}...")
        
        if table_info['sample_data']:
            print("Sample data:")
            for j, row in enumerate(table_info['sample_data'][:3], 1):
                print(f"  Row {j}: {row[:5]}")
    
    # Search for specific census data patterns
    print(f"\n=== SEARCHING FOR CENSUS DATA PATTERNS ===")
    
    census_patterns = [
        r'2011[^.]*census[^.]*tertiary[^.]*education[^.]*?(\d+\.?\d*\s*%?)',
        r'census[^.]*2011[^.]*tertiary[^.]*education[^.]*?(\d+\.?\d*\s*%?)',
        r'tertiary[^.]*education[^.]*2011[^.]*?(\d+\.?\d*\s*%?)[^.]*(?:men|women|male|female)',
        r'(?:men|women|male|female)[^.]*2011[^.]*tertiary[^.]*education[^.]*?(\d+\.?\d*\s*%?)',
        r'higher[^.]*education[^.]*completion[^.]*2011[^.]*?(\d+\.?\d*\s*%?)',
        r'educational[^.]*attainment[^.]*2011[^.]*?(\d+\.?\d*\s*%?)'
    ]
    
    census_findings = []
    for pattern in census_patterns:
        matches = re.finditer(pattern, all_text, re.IGNORECASE | re.DOTALL)
        for match in matches:
            context_start = max(0, match.start() - 300)
            context_end = min(len(all_text), match.end() + 300)
            context = all_text[context_start:context_end]
            
            if 'bulgaria' in context.lower():
                census_findings.append({
                    'pattern': pattern,
                    'match': match.group(),
                    'statistic': match.group(1) if match.groups() else 'No statistic',
                    'context': context
                })
    
    print(f"Census data patterns found: {len(census_findings)}")
    
    for i, finding in enumerate(census_findings, 1):
        print(f"\nFinding {i}:")
        print(f"  Match: {finding['match']}")
        print(f"  Statistic: {finding['statistic']}")
        print(f"  Context: {finding['context'][:250]}...")
else:
    print("Demographics of Bulgaria file not found")

# Save detailed analysis results
detailed_analysis = {
    'analysis_objective': 'Extract specific Bulgarian 2011 census tertiary education completion data by gender',
    'analysis_timestamp': time.strftime('%Y-%m-%d %H:%M:%S'),
    'files_examined': [demographics_file] if demographics_file else [],
    'education_sections_found': len(education_sections) if 'education_sections' in locals() else 0,
    'education_tables_found': len(education_related_tables) if 'education_related_tables' in locals() else 0,
    'census_patterns_found': len(census_findings) if 'census_findings' in locals() else 0,
    'detailed_findings': {
        'education_sections': education_sections if 'education_sections' in locals() else [],
        'education_tables': education_related_tables if 'education_related_tables' in locals() else [],
        'census_findings': census_findings if 'census_findings' in locals() else []
    }
}

detailed_results_file = os.path.join(workspace_path, 'bulgarian_2011_census_detailed_analysis.json')
with open(detailed_results_file, 'w', encoding='utf-8') as f:
    json.dump(detailed_analysis, f, indent=2, ensure_ascii=False)

print(f"\n=== ANALYSIS SUMMARY ===")
print(f"Detailed analysis saved to: {detailed_results_file}")
print(f"Education sections found: {detailed_analysis['education_sections_found']}")
print(f"Education tables found: {detailed_analysis['education_tables_found']}")
print(f"Census patterns found: {detailed_analysis['census_patterns_found']}")

if detailed_analysis['census_patterns_found'] > 0:
    print("\n=== SPECIFIC CENSUS DATA FOUND ===")
    print("Bulgarian 2011 census tertiary education data has been identified in the sources.")
else:
    print("\n=== DATA STATUS ===")
    print("While education-related content was found, specific 2011 census tertiary education")
    print("completion statistics by gender may require access to the original census tables")
    print("or statistical reports from the Bulgarian National Statistical Institute.")

print("\n=== EXTRACTION COMPLETE ===")
```