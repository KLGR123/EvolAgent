### Development Step 2: Extract Professor’s Anagram Question and Criteria from Attached Audio File for Analysis

**Description**: Analyze the attached audio file data/gaia/2023/validation/2b3ef98c-cc05-450b-a719-711aee40ac65.mp3 to extract the professor's anagram question. Listen to the recording to understand what original line or phrase needs to be rearranged into an anagram, and identify the specific request or criteria the professor mentioned for creating the anagram.

**Use Cases**:
- Automated extraction of professor's spoken anagram questions from recorded university lectures to streamline quiz creation for teaching assistants
- Transcribing and analyzing audio submissions in online puzzle competitions to identify and catalog original phrases for anagram challenges
- Processing customer service call recordings to detect and document verbal word games or puzzles used in brand engagement campaigns
- Digitizing and archiving spoken puzzle instructions from educational podcasts for searchable content libraries in edtech platforms
- Assisting accessibility teams by converting audio-based classroom riddles and anagram instructions into text for visually impaired students
- Quality assurance in e-learning platforms by verifying that instructors’ spoken anagram questions match provided written materials
- Automating the review of audio-based language learning exercises to extract and analyze anagram tasks for curriculum developers
- Supporting legal discovery by transcribing and flagging puzzle-related content in audio evidence for intellectual property cases involving game design

```
import os
from mutagen import File
import speech_recognition as sr
from pydub import AudioSegment
import json

# The path to the audio file to be parsed
audio_path = "data/gaia/2023/validation/2b3ef98c-cc05-450b-a719-711aee40ac65.mp3"

print("=== AUDIO FILE ANALYSIS FOR PROFESSOR'S ANAGRAM QUESTION ===")
print(f"Analyzing file: {audio_path}")

# Check if file exists
if not os.path.exists(audio_path):
    print(f"Error: Audio file '{audio_path}' does not exist.")
    # List available files in the validation directory
    validation_dir = "data/gaia/2023/validation/"
    if os.path.exists(validation_dir):
        print(f"Available files in {validation_dir}:")
        for file in os.listdir(validation_dir):
            if file.endswith(('.mp3', '.wav', '.m4a', '.aac')):
                print(f"  - {file}")
else:
    print(f"File exists: {audio_path}")
    file_size = os.path.getsize(audio_path)
    print(f"File size: {file_size} bytes ({file_size / (1024 * 1024):.2f} MB)")

    supported_formats = ['.mp3', '.wav', '.m4a', '.aac', '.flac', '.ogg', '.wma']
    file_ext = os.path.splitext(audio_path)[1].lower()
    print(f"File extension: {file_ext}")

    if file_ext not in supported_formats:
        print(f"Error: Unsupported audio format '{file_ext}'. Supported formats: {', '.join(supported_formats)}")
    else:
        print(f"Audio format is supported: {file_ext}")

        # Extract metadata using mutagen
        print("\n=== EXTRACTING AUDIO METADATA ===")
        audiofile = File(audio_path)
        if audiofile is not None:
            if hasattr(audiofile, 'mime') and audiofile.mime:
                print(f"Format: {audiofile.mime[0]}")
            
            if hasattr(audiofile.info, 'length'):
                duration = audiofile.info.length
                print(f"Duration: {duration:.2f} seconds ({duration/60:.1f} minutes)")
            
            if hasattr(audiofile.info, 'bitrate'):
                print(f"Bitrate: {audiofile.info.bitrate} bps")
            
            # Extract common tags like title, artist, album, date, genre
            tags = ['title', 'artist', 'album', 'date', 'genre']
            for tag in tags:
                if tag in audiofile and audiofile[tag]:
                    print(f"{tag.capitalize()}: {audiofile[tag][0]}")
        else:
            print("Could not extract metadata from audio file")

        # Extract transcription using speech recognition
        print("\n=== CONVERTING AUDIO TO TEXT USING SPEECH RECOGNITION ===")
        print("Loading audio file with pydub...")
        
        try:
            # Load the audio file
            audio = AudioSegment.from_file(audio_path)
            print(f"Audio loaded successfully: {len(audio)} ms duration")
            
            # Create temporary WAV file for speech recognition
            temp_wav = "workspace/temp_anagram_audio.wav"
            print(f"Converting to WAV format for speech recognition: {temp_wav}")
            
            # Ensure workspace directory exists
            os.makedirs("workspace", exist_ok=True)
            
            # Export as WAV with optimal settings for speech recognition
            audio.export(temp_wav, format="wav", parameters=["-ar", "16000", "-ac", "1"])
            print(f"Audio converted to WAV: {os.path.getsize(temp_wav)} bytes")

            # Initialize speech recognizer
            recognizer = sr.Recognizer()
            print("Speech recognizer initialized")

            # Process the audio for transcription
            print("Loading audio into speech recognizer...")
            with sr.AudioFile(temp_wav) as source:
                print("Adjusting for ambient noise...")
                recognizer.adjust_for_ambient_noise(source, duration=0.5)
                
                print("Recording audio data...")
                audio_data = recognizer.record(source)
                print(f"Audio data recorded successfully")
                
                print("\n=== TRANSCRIBING AUDIO TO TEXT ===")
                print("Attempting transcription with Google Speech Recognition...")
                
                # Transcribe audio to text using Google Speech Recognition
                try:
                    text = recognizer.recognize_google(audio_data, language='en-US')
                    
                    print(f"\n*** TRANSCRIPTION SUCCESSFUL ***")
                    print(f"Transcribed text length: {len(text)} characters")
                    
                    print("\n=== PROFESSOR'S ANAGRAM QUESTION CONTENT ===")
                    print(text)
                    
                    # Save the transcription to workspace
                    with open('workspace/professor_anagram_transcription.txt', 'w', encoding='utf-8') as f:
                        f.write("PROFESSOR'S ANAGRAM QUESTION TRANSCRIPTION\n")
                        f.write("=" * 50 + "\n\n")
                        f.write(f"Source: {os.path.basename(audio_path)}\n")
                        f.write(f"Transcribed on: {__import__('datetime').datetime.now().strftime('%Y-%m-%d %H:%M:%S')}\n\n")
                        f.write("TRANSCRIBED CONTENT:\n")
                        f.write("-" * 30 + "\n")
                        f.write(text)
                        f.write("\n" + "-" * 30)
                    
                    print(f"\nTranscription saved to: workspace/professor_anagram_transcription.txt")
                    
                    # Now analyze the text for anagram-related content
                    print("\n=== ANALYZING TEXT FOR ANAGRAM QUESTION ===")
                    print("Searching for anagram instructions and original phrase...")
                    
                    import re
                    
                    # Look for key anagram-related phrases
                    anagram_keywords = [
                        'anagram', 'rearrange', 'letters', 'scramble', 'unscramble',
                        'reorder', 'permutation', 'mix up', 'jumble', 'word puzzle'
                    ]
                    
                    text_lower = text.lower()
                    found_keywords = []
                    
                    for keyword in anagram_keywords:
                        if keyword in text_lower:
                            found_keywords.append(keyword)
                            # Find context around the keyword
                            start_pos = text_lower.find(keyword)
                            context_start = max(0, start_pos - 50)
                            context_end = min(len(text), start_pos + len(keyword) + 50)
                            context = text[context_start:context_end]
                            print(f"Found '{keyword}' in context: ...{context}...")
                    
                    print(f"\nAnagram-related keywords found: {found_keywords}")
                    
                    # Look for quoted phrases or specific instructions
                    print("\n=== SEARCHING FOR QUOTED PHRASES OR SPECIFIC INSTRUCTIONS ===")
                    
                    # Look for quoted text (potential original phrase to anagram) - FIXED REGEX PATTERNS
                    quote_patterns = [
                        r'"([^"]+)"',  # Double quotes
                        r"'([^']+)'",  # Single quotes
                        r'phrase\s+["\']([^"\' ]+)["\']',  # "phrase 'text'"
                        r'line\s+["\']([^"\' ]+)["\']',   # "line 'text'"
                        r'words?\s+["\']([^"\' ]+)["\']', # "word 'text'"
                    ]
                    
                    quoted_phrases = []
                    for pattern in quote_patterns:
                        matches = re.finditer(pattern, text, re.IGNORECASE)
                        for match in matches:
                            phrase = match.group(1)
                            # Get context
                            start_context = max(0, match.start() - 40)
                            end_context = min(len(text), match.end() + 40)
                            context = text[start_context:end_context]
                            
                            quoted_phrases.append({
                                'phrase': phrase,
                                'context': context,
                                'pattern': pattern
                            })
                            print(f"Found quoted phrase: '{phrase}'")
                            print(f"  Context: ...{context}...")
                    
                    # Look for instruction patterns
                    print("\n=== SEARCHING FOR INSTRUCTION PATTERNS ===")
                    
                    instruction_patterns = [
                        r'make an anagram of (.+?)(?:\.|$)',
                        r'create an anagram from (.+?)(?:\.|$)',
                        r'rearrange the letters? of (.+?)(?:\.|$)',
                        r'scramble the word[s]? (.+?)(?:\.|$)',
                        r'form an anagram using (.+?)(?:\.|$)',
                        r'anagram the phrase (.+?)(?:\.|$)',
                        r'take the (?:phrase|line|words?) (.+?) and',
                        r'using the letters? (?:from|in|of) (.+?)(?:,|\.|$)'
                    ]
                    
                    instructions = []
                    for pattern in instruction_patterns:
                        matches = re.finditer(pattern, text, re.IGNORECASE)
                        for match in matches:
                            instruction_text = match.group(1).strip()
                            # Clean up common endings
                            instruction_text = re.sub(r'[,\.]$', '', instruction_text)
                            
                            # Get context
                            start_context = max(0, match.start() - 30)
                            end_context = min(len(text), match.end() + 30)
                            context = text[start_context:end_context]
                            
                            instructions.append({
                                'original_phrase': instruction_text,
                                'context': context,
                                'pattern': pattern
                            })
                            print(f"Found instruction: '{instruction_text}'")
                            print(f"  Context: ...{context}...")
                    
                    # Compile results
                    results = {
                        'source_file': os.path.basename(audio_path),
                        'transcription': text,
                        'anagram_keywords_found': found_keywords,
                        'quoted_phrases': quoted_phrases,
                        'instructions': instructions,
                        'analysis_timestamp': __import__('datetime').datetime.now().isoformat()
                    }
                    
                    # Save detailed analysis
                    with open('workspace/anagram_question_analysis.json', 'w', encoding='utf-8') as f:
                        json.dump(results, f, indent=2)
                    
                    print(f"\n=== ANALYSIS SUMMARY ===")
                    print(f"Anagram keywords found: {len(found_keywords)}")
                    print(f"Quoted phrases found: {len(quoted_phrases)}")
                    print(f"Instruction patterns found: {len(instructions)}")
                    
                    if quoted_phrases:
                        print(f"\nMost likely original phrase(s) to anagram:")
                        for i, phrase_info in enumerate(quoted_phrases, 1):
                            print(f"  {i}. '{phrase_info['phrase']}'")
                    
                    if instructions:
                        print(f"\nInstruction-based phrases to anagram:")
                        for i, inst in enumerate(instructions, 1):
                            print(f"  {i}. '{inst['original_phrase']}'")
                    
                    # Create summary report
                    with open('workspace/anagram_question_summary.txt', 'w', encoding='utf-8') as f:
                        f.write("PROFESSOR'S ANAGRAM QUESTION ANALYSIS SUMMARY\n")
                        f.write("=" * 55 + "\n\n")
                        f.write(f"Source Audio: {os.path.basename(audio_path)}\n\n")
                        
                        f.write("FULL TRANSCRIPTION:\n")
                        f.write("-" * 20 + "\n")
                        f.write(text + "\n")
                        f.write("-" * 20 + "\n\n")
                        
                        if found_keywords:
                            f.write(f"ANAGRAM KEYWORDS DETECTED: {', '.join(found_keywords)}\n\n")
                        
                        if quoted_phrases:
                            f.write("QUOTED PHRASES (Potential Original Text):\n")
                            for i, phrase_info in enumerate(quoted_phrases, 1):
                                f.write(f"  {i}. '{phrase_info['phrase']}'\n")
                            f.write("\n")
                        
                        if instructions:
                            f.write("INSTRUCTION-BASED PHRASES:\n")
                            for i, inst in enumerate(instructions, 1):
                                f.write(f"  {i}. '{inst['original_phrase']}'\n")
                            f.write("\n")
                        
                        f.write("NEXT STEPS:\n")
                        f.write("- Review the identified phrases above\n")
                        f.write("- Determine which phrase the professor wants anagrammed\n")
                        f.write("- Create anagram(s) from the selected phrase\n")
                    
                    print(f"\nDetailed analysis saved to: workspace/anagram_question_analysis.json")
                    print(f"Summary report saved to: workspace/anagram_question_summary.txt")
                    
                except sr.UnknownValueError:
                    print("\n*** TRANSCRIPTION FAILED ***")
                    print("Google Speech Recognition could not understand the audio")
                
                except sr.RequestError as e:
                    print(f"\n*** SPEECH RECOGNITION SERVICE ERROR ***")
                    print(f"Could not request results from Google Speech Recognition service: {e}")

            # Clean up temporary file
            if os.path.exists(temp_wav):
                os.remove(temp_wav)
                print(f"\nTemporary file cleaned up: {temp_wav}")
            
        except Exception as e:
            print(f"\n*** ERROR PROCESSING AUDIO ***")
            print(f"Error: {str(e)}")
            import traceback
            print(f"Full error details: {traceback.format_exc()}")

print("\n*** ANAGRAM QUESTION ANALYSIS COMPLETE ***")
```