### Development Step 6: Exact-Phrase Search of H. pylori/Helicobacter pylori and Acne Vulgaris Trials on ClinicalTrials.gov Jan‚ÄìMay 2018

**Description**: Conduct a more targeted search specifically for clinical trials with exact phrase matching for 'H. pylori' AND 'acne vulgaris' on ClinicalTrials.gov, then expand the search timeframe to include trials that may have been registered or updated during Jan-May 2018 but had different start/end dates. Also search for variations like 'Helicobacter pylori' and 'acne' to ensure comprehensive coverage of potential trial listings that match the TASK criteria.

**Use Cases**:
- Competitive intelligence for pharmaceutical R&D teams analyzing ongoing and completed H. pylori‚Äìacne vulgaris trials to inform drug development roadmaps
- Systematic literature review automation in academic dermatology research, extracting trial details for meta-analysis of Helicobacter pylori‚Äôs role in acne treatment
- Clinical trial portfolio monitoring for CROs, triggering alerts when new or updated H. pylori and acne studies register or post results within a specified 2018 timeframe
- Health informatics integration in hospital EHR systems to match acne patients with relevant H. pylori intervention trials for potential enrollment eligibility
- Regulatory affairs compliance tracking by biotech startups, auditing start, update, and completion dates of H. pylori-acne studies to ensure alignment with FDA reporting requirements
- Medical journal editorial screening tools validating that authors‚Äô manuscripts on H. pylori and acne reference properly registered trials and correct NCT identifiers
- Patient advocacy program development, aggregating detailed summaries of past and present Helicobacter pylori‚Äìacne trials to build accessible resources for support communities
- Market research consulting services quantifying the number, phase distribution, and status of H. pylori‚Äìacne vulgaris trials to identify investment and collaboration opportunities

```
# Since the SerpAPI quota has been exhausted, I'll implement an alternative approach
# by directly accessing ClinicalTrials.gov using their official API and web scraping
# to search for clinical trials involving both H. pylori and acne vulgaris

import requests
import json
import time
from datetime import datetime
from urllib.parse import quote
import re

print("SerpAPI quota exhausted - implementing direct ClinicalTrials.gov search")
print("=" * 80)
print("DIRECT CLINICALTRIALS.GOV SEARCH: H. PYLORI AND ACNE VULGARIS")
print("=" * 80)

# ClinicalTrials.gov API endpoint for searching studies
base_url = "https://clinicaltrials.gov/api/query/study_fields"

# Define search terms for H. pylori and acne
h_pylori_terms = ["H. pylori", "Helicobacter pylori", "H pylori"]
acne_terms = ["acne vulgaris", "acne"]

# Search parameters for different combinations
search_combinations = [
    {"condition": "H. pylori AND acne vulgaris", "terms": ["H. pylori", "acne vulgaris"]},
    {"condition": "Helicobacter pylori AND acne vulgaris", "terms": ["Helicobacter pylori", "acne vulgaris"]},
    {"condition": "H. pylori AND acne", "terms": ["H. pylori", "acne"]},
    {"condition": "Helicobacter pylori AND acne", "terms": ["Helicobacter pylori", "acne"]}
]

# Fields to retrieve from ClinicalTrials.gov
fields = [
    "NCTId",
    "BriefTitle", 
    "OfficialTitle",
    "Condition",
    "InterventionName",
    "StudyFirstSubmitDate",
    "StudyFirstPostDate",
    "LastUpdateSubmitDate",
    "StartDate",
    "CompletionDate",
    "StudyType",
    "Phase",
    "OverallStatus",
    "BriefSummary",
    "DetailedDescription"
]

all_clinical_trials = []
print(f"Searching ClinicalTrials.gov for {len(search_combinations)} different term combinations...\n")

for i, search_combo in enumerate(search_combinations, 1):
    print(f"Search {i}/{len(search_combinations)}: {search_combo['condition']}")
    print("-" * 60)
    
    # Construct the API request
    params = {
        "expr": search_combo['condition'],
        "fields": ",".join(fields),
        "min_rnk": 1,
        "max_rnk": 100,  # Get up to 100 results per search
        "fmt": "json"
    }
    
    try:
        # Make request to ClinicalTrials.gov API
        response = requests.get(base_url, params=params, timeout=30)
        print(f"API Request URL: {response.url}")
        print(f"Response Status: {response.status_code}")
        
        if response.status_code == 200:
            try:
                data = response.json()
                
                # Check if we got results
                if 'StudyFieldsResponse' in data and 'StudyFields' in data['StudyFieldsResponse']:
                    studies = data['StudyFieldsResponse']['StudyFields']
                    print(f"Found {len(studies)} studies")
                    
                    if studies:
                        # Process each study
                        for study in studies:
                            study_info = {
                                'search_terms': search_combo['condition'],
                                'nct_id': study.get('NCTId', [''])[0] if study.get('NCTId') else '',
                                'brief_title': study.get('BriefTitle', [''])[0] if study.get('BriefTitle') else '',
                                'official_title': study.get('OfficialTitle', [''])[0] if study.get('OfficialTitle') else '',
                                'conditions': study.get('Condition', []),
                                'interventions': study.get('InterventionName', []),
                                'study_first_submit_date': study.get('StudyFirstSubmitDate', [''])[0] if study.get('StudyFirstSubmitDate') else '',
                                'study_first_post_date': study.get('StudyFirstPostDate', [''])[0] if study.get('StudyFirstPostDate') else '',
                                'last_update_date': study.get('LastUpdateSubmitDate', [''])[0] if study.get('LastUpdateSubmitDate') else '',
                                'start_date': study.get('StartDate', [''])[0] if study.get('StartDate') else '',
                                'completion_date': study.get('CompletionDate', [''])[0] if study.get('CompletionDate') else '',
                                'study_type': study.get('StudyType', [''])[0] if study.get('StudyType') else '',
                                'phase': study.get('Phase', [''])[0] if study.get('Phase') else '',
                                'status': study.get('OverallStatus', [''])[0] if study.get('OverallStatus') else '',
                                'brief_summary': study.get('BriefSummary', [''])[0] if study.get('BriefSummary') else '',
                                'detailed_description': study.get('DetailedDescription', [''])[0] if study.get('DetailedDescription') else ''
                            }
                            
                            all_clinical_trials.append(study_info)
                            
                            # Display key information
                            print(f"\n  Study: {study_info['nct_id']}")
                            print(f"  Title: {study_info['brief_title']}")
                            print(f"  Conditions: {', '.join(study_info['conditions'])}")
                            print(f"  Submit Date: {study_info['study_first_submit_date']}")
                            print(f"  Start Date: {study_info['start_date']}")
                            print(f"  Status: {study_info['status']}")
                            
                            # Check for 2018 dates
                            dates_to_check = [
                                study_info['study_first_submit_date'],
                                study_info['study_first_post_date'],
                                study_info['last_update_date'],
                                study_info['start_date']
                            ]
                            
                            has_2018_date = any('2018' in str(date) for date in dates_to_check if date)
                            if has_2018_date:
                                print(f"  üéØ 2018 DATE FOUND!")
                    else:
                        print("  No studies found for this search combination")
                else:
                    print("  No StudyFieldsResponse in API response")
                    print(f"  Response keys: {list(data.keys()) if isinstance(data, dict) else 'Not a dict'}")
                    
            except json.JSONDecodeError as e:
                print(f"  Error parsing JSON response: {e}")
                print(f"  Response content (first 500 chars): {response.text[:500]}")
        else:
            print(f"  Error: HTTP {response.status_code}")
            print(f"  Response: {response.text[:500]}")
            
    except Exception as e:
        print(f"  Error during API request: {str(e)}")
    
    # Small delay between requests
    time.sleep(2)
    print()

print("\n" + "=" * 80)
print("CLINICAL TRIALS ANALYSIS")
print("=" * 80)

# Save all results to workspace
timestamp = datetime.now().strftime("%Y%m%d_%H%M%S")
results_file = f"workspace/clinicaltrials_gov_direct_search_{timestamp}.json"

with open(results_file, 'w', encoding='utf-8') as f:
    json.dump({
        'search_method': 'Direct ClinicalTrials.gov API',
        'search_timestamp': timestamp,
        'search_combinations': search_combinations,
        'total_studies_found': len(all_clinical_trials),
        'studies': all_clinical_trials
    }, f, indent=2, ensure_ascii=False)

print(f"Results saved to: {results_file}")
print(f"Total clinical trials found: {len(all_clinical_trials)}")

# Analyze results for H. pylori and acne combination
if all_clinical_trials:
    print(f"\nüìä DETAILED ANALYSIS OF FOUND TRIALS:")
    
    # Filter for trials that mention both H. pylori and acne
    relevant_trials = []
    trials_with_2018_dates = []
    
    for trial in all_clinical_trials:
        # Check if trial mentions both H. pylori and acne
        text_to_search = f"{trial['brief_title']} {trial['official_title']} {' '.join(trial['conditions'])} {trial['brief_summary']} {trial['detailed_description']}".lower()
        
        has_h_pylori = any(term.lower() in text_to_search for term in ['h. pylori', 'helicobacter pylori', 'h pylori'])
        has_acne = any(term.lower() in text_to_search for term in ['acne vulgaris', 'acne'])
        
        if has_h_pylori and has_acne:
            relevant_trials.append(trial)
            print(f"\nüéØ RELEVANT TRIAL FOUND:")
            print(f"  NCT ID: {trial['nct_id']}")
            print(f"  Title: {trial['brief_title']}")
            print(f"  Conditions: {', '.join(trial['conditions'])}")
            print(f"  Submit Date: {trial['study_first_submit_date']}")
            print(f"  Start Date: {trial['start_date']}")
            print(f"  Status: {trial['status']}")
            
        # Check for 2018 dates
        dates_to_check = [
            trial['study_first_submit_date'],
            trial['study_first_post_date'], 
            trial['last_update_date'],
            trial['start_date']
        ]
        
        has_2018_date = any('2018' in str(date) for date in dates_to_check if date)
        if has_2018_date:
            trials_with_2018_dates.append(trial)
    
    print(f"\nüìã SUMMARY:")
    print(f"Total trials found: {len(all_clinical_trials)}")
    print(f"Trials mentioning both H. pylori and acne: {len(relevant_trials)}")
    print(f"Trials with 2018 dates: {len(trials_with_2018_dates)}")
    
    # Check for trials that match both criteria (H. pylori + acne + 2018)
    perfect_matches = []
    for trial in relevant_trials:
        dates_to_check = [
            trial['study_first_submit_date'],
            trial['study_first_post_date'],
            trial['last_update_date'], 
            trial['start_date']
        ]
        has_2018_date = any('2018' in str(date) for date in dates_to_check if date)
        if has_2018_date:
            perfect_matches.append(trial)
    
    if perfect_matches:
        print(f"\nüèÜ PERFECT MATCHES (H. pylori + acne + 2018): {len(perfect_matches)}")
        for match in perfect_matches:
            print(f"  - {match['nct_id']}: {match['brief_title']}")
    else:
        print(f"\n‚ùå No trials found that match all criteria (H. pylori + acne + 2018 timeframe)")
        
        # Show closest matches
        if relevant_trials:
            print(f"\nüìç Closest matches (H. pylori + acne, any date):")
            for trial in relevant_trials[:3]:
                print(f"  - {trial['nct_id']}: {trial['brief_title']} (Submit: {trial['study_first_submit_date']})")
        
        if trials_with_2018_dates:
            print(f"\nüìÖ Trials from 2018 timeframe (any condition):")
            for trial in trials_with_2018_dates[:3]:
                print(f"  - {trial['nct_id']}: {trial['brief_title']} (Submit: {trial['study_first_submit_date']})")
else:
    print("\n‚ùå No clinical trials found in ClinicalTrials.gov database")
    print("This could indicate:")
    print("1. No trials exist for this combination")
    print("2. API search terms need refinement")
    print("3. Trials may be registered under different terminology")

print(f"\n" + "=" * 80)
print("SEARCH COMPLETED - DIRECT CLINICALTRIALS.GOV ACCESS")
print("=" * 80)
```